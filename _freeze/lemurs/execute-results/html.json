{
  "hash": "23f0e25abb5e0bc0ae253e8ca8ebaa46",
  "result": {
    "engine": "knitr",
    "markdown": "---\nfilters:\n  - line-highlight\nexecute: \n  freeze: auto\nfig-width: 5\nfig-asp: 0.67\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n# Lemurs: manipulating images with {magick} and plotting with {cowplot} {#sec-lemurs}\n\nIn this chapter...\n\n## Data\n\n@lemurs_data\n\n\\index{tidytuesdayR!tt\\_load}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(\"2021-08-24\")\nlemurs <- tuesdata$lemurs\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n## Exploratory work\n\n### Data exploration\n\n\\index{graphics!plot}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(\n  lemurs$age_at_wt_mo,\n  lemurs$weight_g\n)\n```\n\n::: {.cell-output-display}\n![Scatter](lemurs_files/figure-html/fig-lemurs-scatter-1.png){#fig-lemurs-scatter}\n:::\n:::\n\n\n\n\n\n\n\\index{graphics!boxplot}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(\n  weight_g ~ taxon,\n  data = lemurs,\n  horizontal = TRUE,\n  xlab = \"Weight\",\n  ylab = NULL\n)\n```\n\n::: {.cell-output-display}\n![Boxplot](lemurs_files/figure-html/fig-lemurs-boxplot-1.png){#fig-lemurs-boxplot}\n:::\n:::\n\n\n\n\n\n\n\n### Exploratory sketches\n\n## Preparing a plot\n\n\n\n### Data wrangling\n\n\\index{dplyr!filter}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncb_lemurs <- lemurs |>\n  dplyr::filter(taxon == \"ECOL\")\n```\n:::\n\n\n\n\n\n\n\n### The first plot\n\n\\index{ggplot2!ggplot} \\index{ggplot2!aes} \\index{ggplot2!geom\\_point}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nbase_plot <- ggplot() +\n  geom_point(\n    data = cb_lemurs,\n    mapping = aes(x = age_at_wt_mo, y = weight_g, color = sex)\n  )\nbase_plot\n```\n\n::: {.cell-output-display}\n![Basic scatter plot](lemurs_files/figure-html/fig-lemurs-base-plot-1.png){#fig-lemurs-base-plot}\n:::\n:::\n\n\n\n\n\n\nnote about assumptions - females heavier than males\n\n* make points smaller and add some transparency\n\n\\index{ggplot2!ggplot} \\index{ggplot2!aes} \\index{ggplot2!geom\\_point}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot <- ggplot() +\n  geom_point(\n    data = cb_lemurs,\n    mapping = aes(x = age_at_wt_mo, y = weight_g, color = sex),\n    alpha = 0.6,\n    size = 0.6\n  )\nbase_plot\n```\n\n::: {.cell-output-display}\n![](lemurs_files/figure-html/unnamed-chunk-11-1.png)\n:::\n:::\n\n\n\n\n\n\n\n## Advanced styling\n\n### Colors\n\nref to blog post male femlae stereotypes\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbg_col <- \"#F5F5DC\"\ntext_col <- \"#4e2e12\"\nf_col <- \"#b13173\"\nm_col <- \"#21ADA8\"\n```\n:::\n\n\n\n\n\n\n\\index{ggplot2!scale\\_color\\_manual}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncol_plot <- base_plot +\n  scale_color_manual(\n    values = c(\"F\" = f_col, \"M\" = m_col),\n    guide = \"none\"\n  )\n```\n:::\n\n\n\n\n\n\n\n### Fonts\n\n\\index{sysfonts!font\\_add\\_google} \\index{showtext!showtext\\_auto} \\index{showtext!showtext\\_opts} \n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsysfonts::font_add_google(\n  name = \"Lato\",\n  family = \"Lato\"\n)\nsysfonts::font_add_google(\n  name = \"Passion One\",\n  family = \"Passion\"\n)\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi = 300)\nbody_font <- \"Lato\"\ntitle_font <- \"Passion\"\n```\n:::\n\n\n\n\n\n\ncoloured text below???\n\n\\index{glue!glue}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntitle <- \"Collared Brown Lemurs\"\nsubtitle <- glue::glue(\"At Duke Lemur Center, collared brown lemurs live to an average of 23.6 years. The oldest collared brown lemur at Duke Lemur Center was Yvette who was born in 1959 and lived to the age of 32.6 years. Collared brown lemurs mature at about 3 years old. Although it may appear that, once fully-grown, <span style='color:{f_col}'>females</span> tend to weigh more than <span style='color:{m_col}'>males</span>, this chart does not account for pregnancy.\")\n```\n:::\n\n\n\n\n\n\n\npre-emptive - or maybe update later\n\n\\index{social\\_caption} \\index{source\\_caption}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsocial <- social_caption(\n  bg_color = bg_col,\n  icon_color = f_col,\n  font_color = text_col,\n  font_family = body_font\n)\ncap <- source_caption(\n  source = \"Duke Lemur Center\",\n  sep = \"<br>\",\n  graphic = social\n)\n```\n:::\n\n\n\n\n\n\n\\index{ggplot2!labs}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntext_plot <- col_plot +\n  labs(\n    title = title,\n    subtitle = subtitle,\n    caption = cap,\n    x = \"Age (months)\", y = \"Weight (g)\"\n  )\ntext_plot\n```\n\n::: {.cell-output-display}\n![Plot](lemurs_files/figure-html/fig-lemurs-labels-1.png){#fig-lemurs-labels}\n:::\n:::\n\n\n\n\n\n\n### Adjusting scales and themes\n\nstill need to edit grid lines and axis text labels formatting colors\n\n\\index{ggplot2!theme\\_minimal} \\index{ggplot2!theme} \\index{ggplot2!element\\_rect} \\index{ggplot2!element\\_text} \n\\index{ggtext!element\\_textbox\\_simple}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_plot <- text_plot +\n  theme_minimal(base_size = 6, base_family = body_font) +\n  theme(\n    # background\n    plot.background = element_rect(\n      fill = bg_col, color = bg_col\n    ),\n    # text\n    plot.title.position = \"plot\",\n    plot.caption.position = \"plot\",\n    plot.title = element_text(\n      family = title_font,\n      size = rel(1.7),\n      color = text_col,\n      margin = margin(b = 5)\n    ),\n    plot.subtitle = ggtext::element_textbox_simple(\n      color = text_col\n    ),\n    plot.caption = ggtext::element_textbox_simple(\n      hjust = 0, halign = 0,\n      color = text_col\n    )\n  )\ntheme_plot\n```\n\n::: {.cell-output-display}\n![Plot](lemurs_files/figure-html/fig-lemurs-style-1-1.png){#fig-lemurs-style-1}\n:::\n:::\n\n\n\n\n\n\n\nadd big margin for image space\n\none option = extend plot margin - but this also squashes titles...\n\n\\index{ggplot2!theme} \\index{ggplot2!margin}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_plot +\n  theme(\n    plot.margin = margin(5, 150, 5, 5)\n  )\n```\n\n::: {.cell-output-display}\n![Plot](lemurs_files/figure-html/fig-lemurs-margin-1-1.png){#fig-lemurs-margin-1}\n:::\n:::\n\n\n\n\n\n\nbetter solution is to (play with limits and adjust )\n\nexpand keeps grid lines, \n\n\\index{ggplot2!scale\\_y\\_continuous} \\index{ggplot2!margin} \\index{ggplot2!dup\\_axis} \\index{ggplot2!element\\_text} \\index{ggplot2!element\\_blank}\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstyled_plot <- theme_plot +\n  scale_y_continuous(sec.axis = dup_axis()) +\n  theme(\n    plot.margin = margin(5, 5, 5, 5),\n    axis.text.y.right = element_text(\n      margin = margin(r = 150),\n      color = bg_col\n    ),\n    axis.title.y.right = element_blank()\n  )\nstyled_plot\n```\n\n::: {.cell-output-display}\n![Plot](lemurs_files/figure-html/fig-lemurs-margin-2-1.png){#fig-lemurs-margin-2}\n:::\n:::\n\n\n\n\n\n\n\nmay wishe to adjust position of axis label\n\n## Images \n\nwhere to find images - unsplash\n@img_jax\n\n### Reading and manipulating images with {magick}\n\nmagick [@magick]\nmention other package\n\nreading image\n\nis this the right image\n\n\\index{magick!image\\_read}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlemur_img <- magick::image_read(\"images/lemur-nobg.png\")\nlemur_img\n```\n\n::: {.cell-output-display}\n![](lemurs_files/figure-html/lemurs-magick-read-1.png){width=131}\n:::\n:::\n\n\n\n\n\n\nmaybe choose a different image\n\n### Adding images to with {cowplot}\n\n[@cowplot]\n\ntip - can also do with patchwork\n\nbefore we add, update caption to add image attribution\n\n\\index{source\\_caption} \\index{ggplot2!labs}\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncap <- paste0(\n  source_caption(source = \"Duke Lemur Center\", sep = \"<br>\", graphic = social),\n  \"<br>**Image**: Jax (Unsplash: @lysrix)\"\n)\nstyled_plot <- styled_plot +\n  labs(caption = cap)\n```\n:::\n\n\n\n\n\n\n\\index{cowplot!ggdraw} \\index{cowplot!draw\\_plot} \\index{cowplot!draw\\_image} \n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfinal_plot <- cowplot::ggdraw() +\n  cowplot::draw_plot(styled_plot) +\n  cowplot::draw_image(\n    lemur_img,\n    x = 1, y = 0,\n    hjust = 1, vjust = 0,\n    halign = 1, valign = 0,\n    width = 0.4\n  )\nfinal_plot\n```\n\n::: {.cell-output-display}\n![Plot](lemurs_files/figure-html/fig-lemurs-img-plot-1.png){#fig-lemurs-img-plot}\n:::\n:::\n\n\n\n\n\n\nadd tip for ggimage\n\nmake text labels and points a little bit smaller (see aes mapping?)\n\n## Reflection\n\nTo do\n- check img credit is right\n- flip image back then flip in R\n- coloured text in subtitle\n- fix subtitle text (pregnant lemurs)\n",
    "supporting": [
      "lemurs_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}