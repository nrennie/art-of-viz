{
  "hash": "2aa9648f56172aaca5eb1498135600f0",
  "result": {
    "engine": "knitr",
    "markdown": "---\nfilters:\n  - line-highlight\nexecute: \n  freeze: auto\nfig-width: 5\nfig-asp: 0.75\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n# Canadian Wind Turbines: waffle plots, pictograms, and icons {#sec-turbines}\n\nIn this chapter, we'll learn how \n\n## Data\n\n[https://open.canada.ca/data/en/dataset/79fdad93-9025-49ad-ba16-c26d718cc070](https://open.canada.ca/data/en/dataset/79fdad93-9025-49ad-ba16-c26d718cc070)\n\n[@readxl] [@openxlsx]\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwind_turbines <- openxlsx::read.xlsx(\"https://ftp.cartes.canada.ca/pub/nrcan_rncan/Wind-energy_Energie-eolienne/wind_turbines_database/Wind_Turbine_Database_FGP.xlsx\", sheet = 1)\nwrite.csv(wind_turbines, \"data/wind_turbines.csv\", row.names = FALSE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwind_turbines <- readr::read_csv(\"data/wind_turbines.csv\")\n```\n:::\n\n\n\n\n\n\n\n## Exploratory work\n\n### Data exploration\n\n### Exploratory sketches\n\n## Preparing a plot\n\n### Data wrangling\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nextract_after_last_slash <- function(texts) {\n  has_slash <- stringr::str_detect(texts, \"/\")\n  extracted <- stringr::str_match(texts, \".*/(.*)$\")[, 2]\n  output <- dplyr::if_else(has_slash, extracted, texts)\n  return(output)\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nturbines_year <- wind_turbines |>\n  dplyr::select(`Province/Territory`, Commissioning.date) |>\n  dplyr::mutate(\n    Year = extract_after_last_slash(Commissioning.date),\n    Year = as.numeric(Year)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_data <- turbines_year |>\n  dplyr::filter(Year >= 2001 & Year <= 2020) |>\n  dplyr::mutate(\n    Year_Group = dplyr::case_when(\n      Year %in% seq(2001, 2005) ~ \"2001 - 2005\",\n      Year %in% seq(2006, 2010) ~ \"2006 - 2010\",\n      Year %in% seq(2011, 2015) ~ \"2011 - 2015\",\n      Year %in% seq(2016, 2020) ~ \"2016 - 2020\"\n    )\n  ) |>\n  dplyr::mutate(\n    Year_Group = factor(Year_Group, levels = c(\n      \"2001 - 2005\", \"2006 - 2010\", \"2011 - 2015\", \"2016 - 2020\"\n    ))\n  ) |>\n  dplyr::rename(Area = `Province/Territory`) |>\n  dplyr::mutate(\n    Area = dplyr::case_when(\n      Area %in% c(\n        \"Northwest Territories\",\n        \"Newfoundland and Labrador\",\n        \"Prince Edward Island\",\n        \"New Brunswick\",\n        \"Manitoba\",\n        \"Saskatchewan\"\n      ) ~ \"other\",\n      TRUE ~ Area\n    )\n  ) |>\n  dplyr::count(Area, Year_Group) |>\n  dplyr::mutate(n = round(n / 20)) |>\n  dplyr::filter(n != 0)\n\narea_levels <- c(plot_data |>\n  dplyr::summarise(n = sum(n), .by = Area) |>\n  dplyr::arrange(-n) |>\n  dplyr::filter(Area != \"other\") |>\n  dplyr::pull(Area), \"other\")\nplot_data$Area <- factor(plot_data$Area, levels = area_levels)\n```\n:::\n\n\n\n\n\n\n### Packages and functions\n\nfont awesome ref\n\nadd instructions about installing system through waffle, where to download\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsysfonts::font_add(\n  family = \"Font Awesome 6\",\n  regular = \"fonts/Font-Awesome-6-Free-Solid-900.otf\"\n)\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi = 300)\n```\n:::\n\n\n\n\n\n\n\n### The first plot\n\n[@waffle]\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nbase_plot <- ggplot(data = plot_data) +\n  waffle::geom_pictogram(\n    mapping = aes(\n      label = Area,\n      colour = Area,\n      values = n\n    ),\n    flip = TRUE,\n    n_rows = 10,\n    size = 3,\n    family = \"Font Awesome 6\"\n  ) +\n  facet_wrap(~Year_Group, nrow = 1, strip.position = \"bottom\")\nbase_plot\n```\n\n::: {.cell-output-display}\n![](canadian-wind-turbines_files/figure-pdf/unnamed-chunk-8-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\nturbine icons not free\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nicons_plot <- base_plot +\n  waffle::scale_label_pictogram(\n    name = NULL,\n    values = c(\"fan\", \"fan\", \"fan\", \"fan\", \"fan\", \"fan\"),\n    guide = \"none\"\n  )\nicons_plot\n```\n\n::: {.cell-output-display}\n![](canadian-wind-turbines_files/figure-pdf/unnamed-chunk-9-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n\n## Advanced styling\n\n### Colors\n\ncopy bit from r-packages section on racrtocolor\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbg_col <- \"#fafafa\"\ntext_col <- \"black\"\ncol_palette <- rcartocolor::carto_pal(length(unique(plot_data$Area)) + 1, \"Vivid\")[1:length(unique(plot_data$Area))]\nnames(col_palette) <- levels(plot_data$Area)\nhighlight_col <- col_palette[1]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncol_plot <- icons_plot +\n  scale_color_manual(\n    values = col_palette,\n    guide = \"none\"\n  )\n```\n:::\n\n\n\n\n\n\n\n### Text and fonts\n\n[@marquee]\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntitle <- \"**Canadian wind turbines are mostly found in Ontario**\"\nst <- glue::glue(\n  \"The Canadian Wind Turbine Database contains the geographic location\n  and key technology details for wind turbines installed in Canada. It includes\n  information about turbines installed in {.[col_palette[[1]]] [names(col_palette)[[1]]]},\n  {.[col_palette[[2]]] [names(col_palette)[[2]]]}, {.[col_palette[[3]]] [names(col_palette)[[3]]]},\n  {.[col_palette[[4]]] [names(col_palette)[[4]]]}, {.[col_palette[[5]]] [names(col_palette)[[5]]]},\n  and {.[col_palette[[6]]] [names(col_palette)[[6]]]} regions.\",\n  .open = \"[\",\n  .close = \"]\"\n)\ncap <- \"**Data**: Natural Resources Canada | **Graphic**: N. Rennie\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntext_plot <- col_plot +\n  labs(\n    title = title,\n    subtitle = st,\n    caption = cap\n  )\ntext_plot\n```\n\n::: {.cell-output-display}\n![](canadian-wind-turbines_files/figure-pdf/unnamed-chunk-13-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n\n### Adjusting scales and themes\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscale_plot <- text_plot +\n  scale_x_discrete(\n    expand = c(0, 0, 0, 0)\n  ) +\n  scale_y_continuous(\n    labels = function(x) format(x * 10 * 20, big.mark = \",\"),\n    expand = c(0, 0),\n    breaks = c(0, 5, 10, 15, 20),\n    limits = c(0, 20),\n    minor_breaks = NULL\n  ) +\n  coord_fixed()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nscale_plot +\n  theme_minimal(\n    base_size = 8\n  ) +\n  theme(\n    plot.title.position = \"plot\",\n    plot.caption.position = \"plot\",\n    plot.margin = margin(5, 10, 5, 10),\n    plot.background = element_rect(fill = bg_col, colour = bg_col),\n    panel.background = element_rect(fill = bg_col, colour = bg_col),\n    panel.grid.major = element_line(\n      linewidth = 0.4\n    ),\n    plot.title = marquee::element_marquee(\n      colour = text_col,\n      width = 1,\n      size = 12,\n      margin = margin(b = -10)\n    ),\n    plot.subtitle = marquee::element_marquee(\n      colour = text_col,\n      width = 1,\n      size = 9\n    ),\n    plot.caption = marquee::element_marquee(\n      hjust = 0,\n      lineheight = 0.5,\n      size = 8,\n      margin = margin(t = 5)\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](canadian-wind-turbines_files/figure-pdf/unnamed-chunk-15-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\nfix order colors are plotted in\n\n## Reflection\n\n* turbines icon\n",
    "supporting": [
      "canadian-wind-turbines_files\\figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}