{
  "hash": "95229ed8980e6ef8ba963bfba9f2f98a",
  "result": {
    "engine": "knitr",
    "markdown": "---\nfilters:\n  - line-highlight\nexecute: \n  freeze: auto\nfig-width: 5\nfig-asp: 0.67\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n# Global Seafood: adding images, rectangles, and text with {grid} {#sec-seafood}\n\n## Data\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load(\"2021-10-12\")\nfarmed <- tuesdata$`aquaculture-farmed-fish-production`\ncaptured_vs_farmed <- tuesdata$`capture-fisheries-vs-aquaculture`\ncaptured <- tuesdata$`capture-fishery-production`\nconsumption <- tuesdata$`fish-and-seafood-consumption-per-capita`\nstock <- tuesdata$`fish-stocks-within-sustainable-levels`\nfishery <- tuesdata$`global-fishery-catch-by-sector`\nproduction <- tuesdata$`seafood-and-fish-production-thousand-tonnes`\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n## Exploratory work\n\n### Data exploration\n\n### Exploratory sketches\n\n![Initial sketch.](images/sketch-seafood.png){#fig-seafood-sketch fig-align=\"center\"}\n\n## Preparing the plots\n\n### Data wrangling\n\n#### Slide 2: Area chart of ...\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(production) <- c(\n  \"Entity\", \"Code\", \"Year\",\n  \"Pelagic Fish\", \"Crustaceans\", \"Cephalopods\",\n  \"Demersal Fish\", \"Freshwater Fish\", \"Other Molluscs\",\n  \"Other Marine Fish\"\n)\np2_data <- production |>\n  tidyr::pivot_longer(\n    cols = 4:10,\n    names_to = \"type\",\n    values_to = \"tonnes\"\n  ) |>\n  dplyr::group_by(Year, type) |>\n  dplyr::summarise(sum = sum(tonnes, na.rm = TRUE)) |>\n  dplyr::ungroup()\n```\n:::\n\n\n\n\n\n\n#### Slide 3: Global map of consumption\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nworld <- rnaturalearth::ne_countries(\n  scale = \"medium\", returnclass = \"sf\"\n)\np3_data <- consumption |>\n  dplyr::filter(Year == 2017) |>\n  dplyr::rename(\n    Consumption = `Fish, Seafood- Food supply quantity (kg/capita/yr) (FAO, 2020)`\n  )\np3_data <- world |>\n  dplyr::left_join(p3_data, by = c(\"iso_a3\" = \"Code\"))\n```\n:::\n\n\n\n\n\n\n#### Slide 4: Line chart of ... \n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np4_data <- stock |>\n  dplyr::filter(Entity == \"World\")\n```\n:::\n\n\n\n\n\n\n\n### Colors and fonts\n\n#### Colors\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(1234)\ncol_palette <- sample(c(\"#f6eff7\", \"#d0d1e6\", \"#a6bddb\", \"#67a9cf\", \"#3690c0\", \"#02818a\", \"#016450\"), size = 7, replace = F)\nbg_col <- \"black\"\ntext_col <- \"#a9bfc4\"\nhighlight_col <- \"#54808b\"\n```\n:::\n\n\n\n\n\n\n#### Fonts\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsysfonts::font_add_google(\n  name = \"Belanosima\",\n  family = \"Belanosima\",\n  db_cache = FALSE\n)\nsysfonts::font_add_google(\n  name = \"Open Sans\",\n  family = \"open\"\n)\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi = 300)\ntitle_font <- \"Belanosima\"\nbody_font <- \"open\"\n```\n:::\n\n\n\n\n\n\n\n### Inset plots\n\n#### Slide 2: Area plot\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\np2 <- ggplot(\n  data = p2_data,\n  mapping = aes(x = Year, y = sum, fill = type)\n) +\n  geom_area() +\n  coord_cartesian(expand = FALSE) +\n  scale_y_continuous(\n    label = scales::label_number(\n      scale_cut = scales::cut_si(\"unit\")\n    )\n  ) +\n  scale_fill_manual(values = col_palette) +\n  labs(x = \"\", y = \"Tonnes per year\\n\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_seafood <-\n  theme(\n    text = element_text(color = text_col),\n    panel.background = element_rect(\n      fill = \"transparent\", color = \"transparent\"\n    ),\n    plot.background = element_rect(\n      fill = alpha(bg_col, 0.4), color = \"transparent\"\n    ),\n    legend.background = element_rect(\n      fill = \"transparent\", color = \"transparent\"\n    ),\n    legend.text = element_text(\n      color = text_col,\n    ),\n    legend.title = element_blank(),\n    legend.position = \"right\",\n    plot.margin = margin(5, 5, 5, 5),\n    axis.title = element_text(color = text_col),\n    axis.text = element_text(color = text_col),\n    axis.ticks = element_line(color = text_col),\n    panel.grid.major = element_line(color = text_col),\n    panel.grid.minor = element_blank()\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np2_theme <- p2 +\n  theme_minimal(base_size = 6, base_family = body_font) +\n  theme_seafood\np2_theme\n```\n\n::: {.cell-output-display}\n![](global-seafood_files/figure-pdf/unnamed-chunk-11-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n#### Slide 3: Global Map\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np3 <- ggplot() +\n  geom_sf(\n    data = p3_data,\n    mapping = aes(fill = Consumption),\n    color = NA\n  ) +\n  labs() +\n  scale_fill_gradient(\"kg/capita\",\n    high = \"#02818a\", low = \"#a6bddb\",\n    breaks = c(25, 50, 75),\n    labels = c(\"  25\", \"  50\", \"  75\")\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np3_theme <- p3 +\n  theme_void() +\n  theme_seafood\np3_theme\n```\n\n::: {.cell-output-display}\n![](global-seafood_files/figure-pdf/unnamed-chunk-13-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n\n\n#### Slide 4: Line chart\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np4 <- ggplot(\n  data = p4_data,\n  mapping = aes(\n    x = Year,\n    y = `Share of fish stocks that are overexploited`\n  )\n) +\n  geom_line(color = \"#54808b\") +\n  geom_point(color = text_col) +\n  coord_cartesian(expand = FALSE) +\n  scale_y_continuous(limits = c(0, 100)) +\n  labs(\n    x = \"\",\n    y = \"% of fish stocks that\\nare over-exploited\\n\"\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np4_theme <- p4 +\n  theme_minimal() +\n  theme_seafood\np4_theme\n```\n\n::: {.cell-output-display}\n![](global-seafood_files/figure-pdf/unnamed-chunk-15-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n\n## Image processing\n\n[@magick]\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_col <- magick::image_read(\"images/fish.jpg\") |>\n  magick::image_resize(\"1200x800\")\n```\n:::\n\n\n\n\n\n\nWe also want a black and white \n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_bw <- img_col |>\n  magick::image_quantize(colorspace = \"gray\")\n```\n:::\n\n\n\n\n\n\n## Elements of slides\n\nother ways of making slides quarto, xaringan\n\n### Common objects\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncaption_rect <- grid::rectGrob(\n  x = grid::unit(0, \"in\"),\n  y = grid::unit(0.25, \"in\"),\n  width = grid::unit(8, \"in\"),\n  height = grid::unit(0.25, \"in\"),\n  hjust = 0, vjust = 1,\n  gp = grid::gpar(fill = \"black\", alpha = 0.4)\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrect <- grid::rectGrob(\n  x = grid::unit(0, \"in\"),\n  y = grid::unit(1, \"npc\") - grid::unit(0.5, \"in\"),\n  width = grid::unit(4.5, \"in\"),\n  height = grid::unit(1, \"in\"),\n  hjust = 0, vjust = 1,\n  gp = grid::gpar(fill = \"black\", alpha = 0.4)\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntext_rect <- grid::rectGrob(\n  x = grid::unit(5, \"in\"),\n  y = grid::unit(1, \"npc\") - grid::unit(1.1, \"in\"),\n  width = grid::unit(2.5, \"in\"),\n  height = grid::unit(2.8, \"in\"),\n  hjust = 0, vjust = 1,\n  gp = grid::gpar(fill = \"black\", alpha = 0.4)\n)\n```\n:::\n\n\n\n\n\n\n### Slide numbers\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncircle1 <- grid::circleGrob(\n  x = 0.08, y = 0.57, r = 0.04,\n  gp = grid::gpar(fill = \"#54808b\")\n)\ncircle2 <- grid::circleGrob(\n  x = 0.08, y = 0.42, r = 0.04,\n  gp = grid::gpar(fill = \"black\", alpha = 0.7)\n)\ncircle3 <- grid::circleGrob(\n  x = 0.08, y = 0.27, r = 0.04,\n  gp = grid::gpar(fill = \"black\", alpha = 0.7)\n)\ncircle4 <- grid::circleGrob(\n  x = 0.08, y = 0.12, r = 0.04,\n  gp = grid::gpar(fill = \"black\", alpha = 0.7)\n)\n# edit to make function that draws all grobs, colors correct circle\n```\n:::\n\n\n\n\n\n\n## Assembling slides\n\n### Slide 1\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cowplot)\nggdraw() +\n  draw_image(img_col) +\n  draw_grob(rect) +\n  draw_grob(caption_rect) +\n  draw_grob(text_rect) +\n  draw_grob(circle1) +\n  draw_grob(circle2) +\n  draw_grob(circle3) +\n  draw_grob(circle4) +\n  draw_label(\n    x = 0.08, y = 0.57, hjust = 0.5, vjust = 0.5, \"1\",\n    color = \"black\", fontface = \"bold\",\n    size = 12, fontfamily = title_font\n  ) +\n  draw_label(\n    label = \"2\",\n    x = 0.08, y = 0.42,\n    hjust = 0.5, vjust = 0.5,\n    color = \"#54808b\", fontface = \"bold\",\n    size = 20, fontfamily = title_font\n  ) +\n  draw_label(\n    x = 0.08, y = 0.27, hjust = 0.5, vjust = 0.5, \"3\",\n    color = \"#54808b\", fontface = \"bold\",\n    size = 20, fontfamily = title_font\n  ) +\n  draw_label(\n    x = 0.08, y = 0.12, hjust = 0.5, vjust = 0.5, \"4\",\n    color = \"#54808b\", fontface = \"bold\",\n    size = 20, fontfamily = title_font\n  ) +\n  draw_label(\n    x = 0.07, y = 0.84, hjust = 0, vjust = 1, \"GLOBAL SEAFOOD\",\n    color = \"#54808b\", fontface = \"bold\",\n    size = 26, fontfamily = title_font\n  ) +\n  draw_label(\n    x = 0.02, y = 0.02, hjust = 0, \"N. Rennie | Data: OurWorldinData.org | Background: Lance Anderson @ Unsplash\",\n    color = text_col, size = 10, fontfamily = body_font\n  ) +\n  draw_label(\n    x = 0.65, y = 0.7, hjust = 0, \"The world now produces more\\nthan 155 million tonnes of\\nseafood each year.\\n\\n\\nIncreasing pressures on fish\\npopulations mean one-third of\\nglobal fish stocks are over-\\nexploited â€“ this has increased\\nfrom 10% in the 1970s.\",\n    color = text_col, size = 11, fontfamily = body_font, vjust = 1\n  )\n```\n\n::: {.cell-output-display}\n![](global-seafood_files/figure-pdf/unnamed-chunk-22-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n### Slide 2\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggdraw() +\n  draw_image(img_bw) +\n  draw_grob(caption_rect) +\n  draw_grob(text_rect) +\n  draw_grob(circle1) +\n  draw_grob(circle2) +\n  draw_grob(circle3) +\n  draw_grob(circle4) +\n  draw_plot(p2_theme, .21, .15, .73, .5) +\n  draw_label(\n    x = 0.08, y = 0.57, hjust = 0.5, vjust = 0.5, \"1\",\n    color = \"#54808b\", fontface = \"bold\", size = 20, fontfamily = title_font\n  ) +\n  draw_label(\n    x = 0.08, y = 0.42, hjust = 0.5, vjust = 0.5, \"2\",\n    color = \"black\", fontface = \"bold\", size = 20, fontfamily = title_font\n  ) +\n  draw_label(\n    x = 0.08, y = 0.27, hjust = 0.5, vjust = 0.5, \"3\",\n    color = text_col, fontface = \"bold\", size = 20, fontfamily = title_font\n  ) +\n  draw_label(\n    x = 0.08, y = 0.12, hjust = 0.5, vjust = 0.5, \"4\",\n    color = text_col, fontface = \"bold\", size = 20, fontfamily = title_font\n  ) +\n  draw_label(\n    x = 0.02, y = 0.02, hjust = 0, \"N. Rennie | Data: OurWorldinData.org | Background: Lance Anderson @ Unsplash\",\n    color = text_col, size = 10, fontfamily = body_font\n  ) +\n  draw_label(\n    x = 0.1, y = 0.85, hjust = 0, \"Global seafood and fish production is higher than it has ever been with 681,822,807 tonnes\\nproduced in 2013. In 1961, that value was only 173,034,558. The largest growth in production\\nhas been seen in freshwater fish, especially since 2000.\",\n    color = text_col, size = 11, fontfamily = body_font, vjust = 1\n  )\n```\n\n::: {.cell-output-display}\n![](global-seafood_files/figure-pdf/unnamed-chunk-23-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n\n### Slide 3\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggdraw() + \n  draw_image(img_bw) + \n  draw_grob(caption_rect) +\n  draw_grob(text_rect) +\n  draw_grob(circle1) +\n  draw_grob(circle2) +\n  draw_grob(circle3) +\n  draw_grob(circle4) +\n  draw_plot(p3_theme, .21, .15, .73, .5) +\n  draw_label(x=0.08, y=0.57, hjust=0.5, vjust=0.5, \"1\", \n             color = \"#54808b\", fontface=\"bold\", size = 20, fontfamily=title_font) +\n  draw_label(x=0.08, y=0.42, hjust=0.5, vjust=0.5, \"2\", \n             color = \"#54808b\", fontface=\"bold\", size = 20, fontfamily=title_font) +\n  draw_label(x=0.08, y=0.27, hjust=0.5, vjust=0.5, \"3\", \n             color = \"black\", fontface=\"bold\", size = 20, fontfamily=title_font) +\n  draw_label(x=0.08, y=0.12, hjust=0.5, vjust=0.5, \"4\", \n             color = \"#54808b\", fontface=\"bold\", size = 20, fontfamily=title_font) +\n  draw_label(x=0.02, y=0.02, hjust=0, \"N. Rennie | Data: OurWorldinData.org | Background: Lance Anderson @ Unsplash\", \n             color = \"#a9bfc4\", size = 10, fontfamily=body_font) +\n  draw_label(x=0.1, y=0.85, hjust=0, \"In 2017, average annual consumption of fish and seafood was 19.24kg per capita, up from\\n11.62kg per capita in 1961. Iceland recorded the highest consumption per capita in 2017,\\nat 90.7 kg per year.\", \n             color = \"#a9bfc4\", size = 11, fontfamily=body_font, vjust=1) \n```\n\n::: {.cell-output-display}\n![](global-seafood_files/figure-pdf/unnamed-chunk-24-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\n\n### Slide 4\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggdraw() + \n  draw_image(img_bw) + \n  draw_grob(caption_rect) +\n  draw_grob(text_rect) +\n  draw_grob(circle1) +\n  draw_grob(circle2) +\n  draw_grob(circle3) +\n  draw_grob(circle4) +\n  draw_plot(p4_theme, .21, .15, .73, .5) +\n  draw_label(x=0.08, y=0.57, hjust=0.5, vjust=0.5, \"1\", \n             color = \"#54808b\", fontface=\"bold\", size = 20, fontfamily=title_font) +\n  draw_label(x=0.08, y=0.42, hjust=0.5, vjust=0.5, \"2\", \n             color = \"#54808b\", fontface=\"bold\", size = 20, fontfamily=title_font) +\n  draw_label(x=0.08, y=0.27, hjust=0.5, vjust=0.5, \"3\", \n             color = \"#54808b\", fontface=\"bold\", size = 20, fontfamily=title_font) +\n  draw_label(x=0.08, y=0.12, hjust=0.5, vjust=0.5, \"4\", \n             color = \"black\", fontface=\"bold\", size = 20, fontfamily=title_font) +\n  draw_label(x=0.02, y=0.02, hjust=0, \"N. Rennie | Data: OurWorldinData.org | Background: Lance Anderson @ Unsplash\", \n             color = \"#a9bfc4\", size = 10, fontfamily=body_font) +\n  draw_label(x=0.1, y=0.84, hjust=0, \"The share of fish stocks which are over-exploited has been steadily increasing since the\\n1970s. In some areas of the world, the share of over-exploited stock exceeds 60%.\", \n             color = \"#a9bfc4\", size = 11, fontfamily=body_font, vjust=1) \n```\n\n::: {.cell-output-display}\n![](global-seafood_files/figure-pdf/unnamed-chunk-25-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n\n\n\nall over - need to fix sizing, theme appearance, functions for numbers, variables replacement\n\n\n## Reflection\n\n* Would I actually make slides this way? No.\n",
    "supporting": [
      "global-seafood_files\\figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}