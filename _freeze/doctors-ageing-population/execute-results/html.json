{
  "hash": "207ba8895ca54d51c78347bfd2434b63",
  "result": {
    "engine": "knitr",
    "markdown": "---\nfig-width: 6\nfig-height: 4\nfig-align: center\nfig-dpi: 300\nfilters:\n  - line-highlight\nexecute: \n  freeze: auto\n---\n\n\n# Doctors in an ageing population: making maps with {ggplot2} {#doctors}\n\nIn this chapter... we'll learn how to idenifty open data sources, make maps with ggplot2 using maps package, and create .... with a ... to facets.\n\n## Data \n\nBring your own data\n\n### Common data sources\n\n### Doctors data\n\nThe ... comes from Our World in Data [@doctors_data]\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndoctors <- readr::read_csv(\"data/doctors.csv\")\n```\n:::\n\n\n## Initial exploration\n\n## Sketches\n\n## Data wrangling\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\nlibrary(dplyr)\ndoctors <- doctors |>\n  rename(region = entity, doctors = `Physicians (per 1,000 people)`) |>\n  select(region, year, doctors) |>\n  group_by(region) |>\n  slice_max(year) |>\n  ungroup()\n```\n:::\n\n\n## Map data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nworld <- map_data(\"world\")\nlength(unique(world$region))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 252\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(unique(doctors$region))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 221\n```\n\n\n:::\n:::\n\n\nNote that `recode` has the rather unusual syntax of old_name = new_name\n\n\\index{dplyr!recode}\n\\index{dplyr!left\\_join}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_data <- doctors |>\n  mutate(\n    country =\n      recode(region,\n        \"United Kingdom\" = \"UK\",\n        \"United States\" = \"USA\",\n        \"Congo, Dem. Rep.\" = \"Democratic Republic of the Congo\",\n        \"Cote d'Ivoire\" = \"Ivory Coast\",\n        \"Congo, Rep.\" = \"Republic of Congo\"\n      )\n  )\nmap_data <- left_join(world, plot_data, by = \"region\") |>\n  filter(region != \"Antarctica\")\n```\n:::\n\n\n\n## Plot\n\n### Basic plot\n\n\\index{ggplot2!geom\\_map}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(\n  data = map_data,\n  mapping = aes(\n    long,\n    lat,\n    map_id = region,\n    fill = doctors\n  )\n) +\n  geom_map(\n    map = map_data\n  )\n```\n\n::: {.cell-output-display}\n![](doctors-ageing-population_files/figure-html/doctors-basic-plot-1-1.png){width=1800}\n:::\n:::\n\n\nnot a great colour scheme\nbit stretched looking\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(\n  data = map_data,\n  mapping = aes(\n    long,\n    lat,\n    map_id = region,\n    fill = doctors\n  )\n) +\n  geom_map(\n    map = map_data\n  ) #+\n```\n\n::: {.cell-output-display}\n![](doctors-ageing-population_files/figure-html/doctors-basic-plot-2-1.png){width=1800}\n:::\n\n```{.r .cell-code}\n  #coord_map()\n```\n:::\n\n\n> Note: ℹ The package \"mapproj\" is required for `coord_map()`.\n✖ Would you like to install it?\n\n1: Yes\n2: No\n\n### Text and font\n\n\\index{sysfonts!font\\_add\\_google}\n\\index{showtext!showtext\\_auto}\n\\index{showtext!showtext\\_opts}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsysfonts::font_add_google(name = \"Roboto\", family = \"roboto\")\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi = 300)\nbody_font <- \"roboto\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntitle <- \"Doctors in an ageing population\"\nst <- \"This map show the number of doctors per thousand people, rescaled by the percentage of the population aged over 70, revealing which countries* may be more likely to struggle in providing care for an elderly population.<br> using most recent available data for each country.\"\ncap <- \"**Data**: Our World in Data | **Graphic**: N. Rennie\"\n```\n:::\n\n\n### Colours\n\n\\index{MetBrewer}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MetBrewer)\ncol_palette <- met.brewer(\"Hokusai2\", n = 20)\ntext_col <- col_palette[18]\nhighlight_col <- col_palette[15]\nbg_col <- \"#EADEDA\"\n```\n:::\n\n\nlines of map same colour as bg and a little bit thinner\nadd text\n\n\\index{ggtext!element\\_textbox\\_simple}\n\\index{ggplot2!scale\\_fill\\_gradientn}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggtext)\nggplot(\n  data = map_data,\n  mapping = aes(\n    long,\n    lat,\n    map_id = region,\n    fill = doctors\n  )\n) +\n  geom_map(\n    map = map_data,\n    color = bg_col,\n    linewidth = 0.05\n  ) +\n  labs(title = title, \n       subtitle = st,\n       caption = cap) +\n  scale_fill_gradientn(\n    colours = col_palette,\n    limits = c(0, 10),\n    breaks = c(0.5, 9.5),\n    labels = c(\"Fewer doctors\", \"More doctors\")\n  ) +\n  theme_void(base_family = body_font) +\n  theme(\n    plot.background = element_rect(fill = bg_col, colour = bg_col),\n    panel.background = element_rect(fill = bg_col, colour = bg_col),\n    plot.title = element_textbox_simple(\n      colour = text_col\n    ),\n    plot.subtitle = element_textbox_simple(\n      colour = text_col\n    ),\n    plot.caption = element_textbox_simple(\n      hjust = 0,\n      colour = text_col\n    ))\n```\n\n::: {.cell-output-display}\n![](doctors-ageing-population_files/figure-html/doctors-style-plot-1-1.png){width=1800}\n:::\n:::\n\n\n### Box for title facets\n\n\\index{ggplot2!facet\\_wrap}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(\n  data = map_data,\n  mapping = aes(long,\n    lat,\n    map_id = region,\n    fill = log10(ratio)\n  )\n) +\n  geom_map(\n    map = map_data,\n    color = \"#EADEDA\",\n    size = 0.05\n  ) +\n  scale_y_continuous(limits = c(-60, 120)) +\n  scale_fill_gradientn(\n    colours = met.brewer(\"Hokusai2\", n = 20),\n    limits = c(-1.8, 0.7),\n    breaks = c(-1.6, 0.5),\n    labels = c(\"Fewer doctors\", \"More doctors\")\n  ) +\n  facet_wrap(~label) +\n  labs(\n    tag = usefunc::str_wrap_break(st, 120),\n    caption = \"N. Rennie | Data: Gapminder\"\n  ) +\n  guides(fill = guide_colourbar(ticks = FALSE)) +\n  theme_void() +\n  theme(\n    plot.background = element_rect(fill = \"#EADEDA\", colour = \"#EADEDA\"),\n    panel.background = element_rect(fill = \"#EADEDA\", colour = \"#EADEDA\"),\n    strip.text = element_text(\n      family = \"slab\", lineheight = 0.4, hjust = 0,\n      colour = \"#EADEDA\", size = 48,\n      margin = margin(\n        t = 10,\n        l = 10,\n        b = 10\n      )\n    ),\n    strip.background = element_rect(fill = \"#1B5681\", colour = \"#1B5681\"),\n    plot.tag.position = c(0.03, 0.78),\n    plot.tag = element_text(\n      family = \"roboto\", lineheight = 0.4, size = 24,\n      colour = \"#0E3F62\", hjust = 0\n    ),\n    plot.caption = element_text(\n      family = \"roboto\", lineheight = 0.4,\n      size = 24, hjust = 0.03,\n      colour = \"#0E3F62\"\n    ),\n    legend.text = element_text(\n      family = \"roboto\", lineheight = 0.4,\n      size = 24, hjust = 0.5,\n      colour = \"#0E3F62\"\n    ),\n    legend.key.width = unit(2, \"cm\"),\n    legend.key.height = unit(0.3, \"cm\"),\n    legend.position = c(0.645, -0.005),\n    legend.title = element_blank(),\n    legend.direction = \"horizontal\",\n    plot.margin = margin(0, 0, 10, 0)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_data$label <- \"Doctors in an ageing population\"\n```\n:::\n\n\n### Text \n\n\n::: {.cell}\n\n```{.r .cell-code}\nst <- \"This map show the number of doctors per thousand people, rescaled by the percentage of the population aged over 70, revealing which countries* may be more likely to struggle in providing care for an elderly population.\\n\\n* using most recent available data for each country.\"\n```\n:::\n\n\n\n::: {.content-visible when-format=\"html\"}\n\nsee the making of . If you'd like to read more about {camcorder} - see chapter ... .\n\n![](images/doctors.gif)\n\n:::\n\n",
    "supporting": [
      "doctors-ageing-population_files\\figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}