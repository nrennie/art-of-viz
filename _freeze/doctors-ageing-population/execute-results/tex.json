{
  "hash": "bc44d1606c364a2626c60106e17dcfbc",
  "result": {
    "engine": "knitr",
    "markdown": "---\nfig-width: 5\nfig-asp: 0.67\nfig-align: center\nfig-dpi: 300\nfilters:\n  - line-highlight\nexecute: \n  freeze: auto\n---\n\n\n\n# Doctors in an ageing population: making maps with {ggplot2} {#doctors}\n\nIn this chapter... we'll learn how to idenifty open data sources, make maps with ggplot2 using maps package, and create .... with a ... to facets.\n\n## Data \n\n* Bring your own data\n* Common data sources\n* Doctors data\n\nThe ... comes from Our World in Data [@doctors_data]\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndoctors <- readr::read_csv(\"data/doctors.csv\")\n```\n:::\n\n\n\n\\index{readr!read\\_csv}\n\n## Exploratory work\n\n### Data exploration\n\nwhat does data look like\n\n### Exploratory sketches\n\n## Preparing a plot\n\n### Data wrangling\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndoctors <- doctors |>\n  dplyr::rename(region = entity, doctors = `Physicians (per 1,000 people)`) |>\n  dplyr::select(region, year, doctors) |>\n  dplyr::group_by(region) |>\n  dplyr::slice_max(year) |>\n  dplyr::ungroup()\n```\n:::\n\n\n\nRetrieving map data with {ggplot2}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nworld <- map_data(\"world\")\nlength(unique(world$region))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 252\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(unique(doctors$region))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 221\n```\n\n\n:::\n:::\n\n\n\nNote that `recode` has the rather unusual syntax of old_name = new_name\n\n\\index{dplyr!recode}\n\\index{dplyr!left\\_join}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_data <- doctors |>\n  dplyr::mutate(\n    region =\n      dplyr::recode(region,\n        \"United Kingdom\" = \"UK\",\n        \"United States\" = \"USA\",\n        \"Congo, Dem. Rep.\" = \"Democratic Republic of the Congo\",\n        \"Cote d'Ivoire\" = \"Ivory Coast\",\n        \"Congo, Rep.\" = \"Republic of Congo\"\n      )\n  )\nmap_data <- dplyr::left_join(world, plot_data, by = \"region\") |>\n  dplyr::filter(region != \"Antarctica\")\n```\n:::\n\n\n\n\n### The first plot\n\n\\index{ggplot2!geom\\_map}\n\n\\index{map}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase_plot <- ggplot(\n  data = map_data,\n  mapping = aes(\n    long,\n    lat,\n    map_id = region,\n    fill = doctors\n  )\n) +\n  geom_map(\n    map = map_data\n  )\nbase_plot\n```\n\n::: {.cell-output-display}\n![Map of the world with countries colored based on number of doctors per 1,000 people. The map looks stretched.](doctors-ageing-population_files/figure-pdf/fig-doctors-basic-plot-1-1.pdf){#fig-doctors-basic-plot-1 fig-pos='H'}\n:::\n:::\n\n\n\n## Advanced styling\n\n### Colors\n\n\\index{MetBrewer}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(MetBrewer)\ncol_palette <- met.brewer(\"Hokusai2\", n = 20)\ntext_col <- col_palette[18]\nhighlight_col <- col_palette[15]\nbg_col <- \"#EADEDA\"\n```\n:::\n\n\n\n\\index{ggplot2!scale\\_fill\\_gradientn}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncol_plot <- base_plot +\n  scale_fill_gradientn(\n    colors = col_palette,\n    limits = c(0, 10),\n    breaks = c(0.5, 9.5),\n    labels = c(\"Fewer doctors\", \"More doctors\")\n  ) +\n  guides(fill = guide_colorbar(ticks = FALSE))\ncol_plot\n```\n\n::: {.cell-output-display}\n![Map of the world with countries colored based on number of doctors per 1,000 people, showing a different color scheme.](doctors-ageing-population_files/figure-pdf/fig-doctors-style-plot-1-1.pdf){#fig-doctors-style-plot-1 fig-pos='H'}\n:::\n:::\n\n\n\n### Text and fonts\n\n{sysfonts}\\index{sysfonts}\n{showtext}\\index{showtext}\n\n\\index{sysfonts!font\\_add\\_google}\n\\index{showtext!showtext\\_auto}\n\\index{showtext!showtext\\_opts}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsysfonts::font_add_google(name = \"Roboto\", family = \"roboto\")\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi = 300)\nbody_font <- \"roboto\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntitle <- \"Doctors in an ageing population\"\nst <- \"This map show the number of doctors per thousand people, rescaled by the percentage of the population aged over 70, revealing which countries* may be more likely to struggle in providing care for an elderly population.<br> using most recent available data for each country.\"\ncap <- \"**Data**: Our World in Data | **Graphic**: N. Rennie\"\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntext_plot <- col_plot +\n  labs(\n    title = title, subtitle = st, caption = cap\n  )\n```\n:::\n\n\n\n### Adjusting themes\n\n\\index{ggtext!element\\_textbox\\_simple}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggtext)\ntext_plot +\n  theme_void(base_size = 8, base_family = body_font) +\n  theme(\n    plot.background = element_rect(fill = bg_col, color = bg_col),\n    panel.background = element_rect(fill = bg_col, color = bg_col),\n    plot.title = element_textbox_simple(\n      color = text_col\n    ),\n    plot.subtitle = element_textbox_simple(\n      color = text_col\n    ),\n    plot.caption = element_textbox_simple(\n      hjust = 0,\n      color = text_col\n    ))\n```\n\n::: {.cell-output-display}\n![Map of the world with countries colored based on number of doctors per 1,000 people. Styling ...](doctors-ageing-population_files/figure-pdf/fig-doctors-style-plot-3-1.pdf){#fig-doctors-style-plot-3 fig-pos='H'}\n:::\n:::\n\n\n\n\nBox for title facets\n\n\\index{ggplot2!facet\\_wrap}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_data$label <- title\n```\n:::\n\n\n\nWhile we're here, let's lines of map same color as bg and a little bit thinner\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstyled_plot <- ggplot(\n  data = map_data,\n  mapping = aes(\n    long,\n    lat,\n    map_id = region,\n    fill = doctors\n  )\n) +\n  geom_map(\n    map = map_data,\n    color = bg_col,\n    linewidth = 0.5\n  ) +\n  scale_fill_gradientn(\n    colors = col_palette,\n    limits = c(0, 10),\n    breaks = c(0.5, 9.5),\n    labels = c(\"Fewer doctors\", \"More doctors\")\n  ) +\n  guides(fill = guide_colorbar(ticks = FALSE)) +\n  labs(\n    title = title, subtitle = st, caption = cap\n  ) +\n  facet_wrap(~label) +\n  theme_void(base_size = 8, base_family = body_font) +\n  theme(\n    plot.background = element_rect(\n      fill = bg_col, color = bg_col),\n    panel.background = element_rect(\n      fill = bg_col, color = bg_col),\n    plot.title = element_textbox_simple(\n      color = text_col,\n      lineheight = 0.5\n    ),\n    plot.subtitle = element_textbox_simple(\n      color = text_col,\n      lineheight = 0.5\n    ),\n    plot.caption = element_textbox_simple(\n      hjust = 0,\n      color = text_col,\n      lineheight = 0.5\n    ),\n    strip.background = element_rect(\n      fill = highlight_col, color = highlight_col))\nstyled_plot\n```\n\n::: {.cell-output-display}\n![caption](doctors-ageing-population_files/figure-pdf/fig-doctors-style-plot-4-1.pdf){#fig-doctors-style-plot-4 fig-pos='H'}\n:::\n:::\n\n\n\nmove subtitle text \nNote `legend.position.inside` used to be `legend.position` before ggplot2 3.5.0\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstyled_plot +\n  labs(\n    subtitle = NULL, tag = st\n  ) +\n  theme(\n    # move and format the tag (subtitle) text\n    plot.tag.position = c(0.03, 0.78),\n    plot.tag = element_textbox_simple(\n      color = text_col,\n      lineheight = 0.5,\n      hjust = 0\n    ),\n    # change title text color\n    plot.title = element_textbox_simple(\n      color = bg_col,\n      lineheight = 0.5\n    ),\n    # style the legend\n    legend.text = element_text(\n      color = text_col,\n      lineheight = 0.5,\n      hjust = 0.5\n    ),\n    legend.key.width = unit(2, \"cm\"),\n    legend.key.height = unit(0.3, \"cm\"),\n    legend.position.inside = c(0.645, -0.005),\n    legend.title = element_blank(),\n    legend.direction = \"horizontal\",\n    plot.margin = margin(0, 0, 10, 0)\n  )\n```\n\n::: {.cell-output-display}\n![caption](doctors-ageing-population_files/figure-pdf/fig-doctors-style-plot-5-1.pdf){#fig-doctors-style-plot-5 fig-pos='H'}\n:::\n:::\n\n\n\n\n## Reflection\n\n> Note: ℹ The package \"mapproj\" is required for `coord_map()`.\n✖ Would you like to install it?\n\n1: Yes\n2: No\n\nfewer/more labels\n\n::: {.content-visible when-format=\"html\"}\n\nsee the making of . If you'd like to read more about {camcorder} - see chapter ... .\n\n![](images/doctors.gif)\n\n:::\n\n",
    "supporting": [
      "doctors-ageing-population_files\\figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}