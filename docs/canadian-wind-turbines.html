<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>6&nbsp; Canadian Wind Turbines: waffle plots, pictograms, and icons – The TidyTuesday Cookbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./cats.html" rel="next">
<link href="./text.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./text.html">Making use of icons, fonts, and text</a></li><li class="breadcrumb-item"><a href="./canadian-wind-turbines.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Canadian Wind Turbines: waffle plots, pictograms, and icons</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The TidyTuesday Cookbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./author.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Author</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./common-charts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Common charts don't need to be boring!</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./programming-languages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Programming Languages: dumbbell charts with {ggplot2}</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./uk-museums.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">UK Museums: highlighting line charts with {gghighlight}</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bee-colony-losses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bee Colony Losses: visualising quantities with Poisson disk sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./technology-adoption.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Technology Adoption: making gauge charts with {ggforce}</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making use of icons, fonts, and text</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./canadian-wind-turbines.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Canadian Wind Turbines: waffle plots, pictograms, and icons</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Cats: data-driven annotations with {ggtext}</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nobel-prize-laureates.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Nobel Prize Laureates: positioning text and parameterising plots</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./images.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with images</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lemurs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Lemurs: manipulating images with {magick}</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">R Packages: using images for custom facet labels</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./global-seafood.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Global Seafood: adding images, rectangles, and text with {grid}</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./spatial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualising spatial data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./doctors-ageing-population.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Doctors in an Ageing Population: making maps with {ggplot2}</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-zones.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Time Zones: spatial data and mapping with {sf}</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./us-house-elections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">US House Elections: geography on a grid with {geofacet}</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./other-tricks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Other tips and tricks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bibliography</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li>
<a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data"><span class="header-section-number">6.1</span> Data</a>
  <ul class="collapse">
<li><a href="#reading-data-with-openxlsx" id="toc-reading-data-with-openxlsx" class="nav-link" data-scroll-target="#reading-data-with-openxlsx"><span class="header-section-number">6.1.1</span> Reading data with {openxlsx}</a></li>
  </ul>
</li>
  <li>
<a href="#exploratory-work" id="toc-exploratory-work" class="nav-link" data-scroll-target="#exploratory-work"><span class="header-section-number">6.2</span> Exploratory work</a>
  <ul class="collapse">
<li><a href="#data-exploration" id="toc-data-exploration" class="nav-link" data-scroll-target="#data-exploration"><span class="header-section-number">6.2.1</span> Data exploration</a></li>
  <li><a href="#exploratory-sketches" id="toc-exploratory-sketches" class="nav-link" data-scroll-target="#exploratory-sketches"><span class="header-section-number">6.2.2</span> Exploratory sketches</a></li>
  </ul>
</li>
  <li>
<a href="#preparing-a-plot" id="toc-preparing-a-plot" class="nav-link" data-scroll-target="#preparing-a-plot"><span class="header-section-number">6.3</span> Preparing a plot</a>
  <ul class="collapse">
<li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling"><span class="header-section-number">6.3.1</span> Data wrangling</a></li>
  <li><a href="#installing-font-awesome-fonts" id="toc-installing-font-awesome-fonts" class="nav-link" data-scroll-target="#installing-font-awesome-fonts"><span class="header-section-number">6.3.2</span> Installing Font Awesome fonts</a></li>
  <li><a href="#the-first-plot-with-waffle" id="toc-the-first-plot-with-waffle" class="nav-link" data-scroll-target="#the-first-plot-with-waffle"><span class="header-section-number">6.3.3</span> The first plot with {waffle}</a></li>
  </ul>
</li>
  <li>
<a href="#advanced-styling" id="toc-advanced-styling" class="nav-link" data-scroll-target="#advanced-styling"><span class="header-section-number">6.4</span> Advanced styling</a>
  <ul class="collapse">
<li><a href="#colors-with-rcartocolor" id="toc-colors-with-rcartocolor" class="nav-link" data-scroll-target="#colors-with-rcartocolor"><span class="header-section-number">6.4.1</span> Colors with {rcartocolor}</a></li>
  <li><a href="#adding-styled-text-with-marquee" id="toc-adding-styled-text-with-marquee" class="nav-link" data-scroll-target="#adding-styled-text-with-marquee"><span class="header-section-number">6.4.2</span> Adding styled text with {marquee}</a></li>
  <li><a href="#adjusting-scales-and-themes" id="toc-adjusting-scales-and-themes" class="nav-link" data-scroll-target="#adjusting-scales-and-themes"><span class="header-section-number">6.4.3</span> Adjusting scales and themes</a></li>
  </ul>
</li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection"><span class="header-section-number">6.5</span> Reflection</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./text.html">Making use of icons, fonts, and text</a></li><li class="breadcrumb-item"><a href="./canadian-wind-turbines.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Canadian Wind Turbines: waffle plots, pictograms, and icons</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-turbines" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Canadian Wind Turbines: waffle plots, pictograms, and icons</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>In this chapter, we’ll learn how to read in data from an Excel file via a URL, create waffle plots using the {waffle} package, and write a subtitle with colored text to be used as an alternative to a traditional legend.</p>
<section id="data" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="data">
<span class="header-section-number">6.1</span> Data</h2>
<p>Back in October 2020, data on wind turbines in Canada from the Government of Canada Open Data portal was used as a <a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-10-27">TidyTuesday dataset</a> <span class="citation" data-cites="tidytuesday">(<a href="references.html#ref-tidytuesday" role="doc-biblioref">R4DS Online Learning Community 2023</a>)</span>. The Canadian Wind Turbine Database provides information about wind turbines installed in Canada, including their power capacity and geographic location <span class="citation" data-cites="turbines_data">(<a href="references.html#ref-turbines_data" role="doc-biblioref">Natural Resources Canada 2021</a>)</span>. Rather than reading in the data using the {tidytuesdayR} package as we’ve done in previous chapters, let’s read in the data directly from the <a href="https://open.canada.ca/en">open.canada.ca</a> website.</p>
<div id="tip-turbines-open" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip&nbsp;6.1: Open Government data in Canada
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Canadian Wind Turbine data contains information licensed under the <a href="https://open.canada.ca/en/open-government-licence-canada">Open Government Licence - Canada</a>.</p>
<p>You can search for more open data at <a href="https://search.open.canada.ca/opendata/">search.open.canada.ca/opendata</a>.</p>
</div>
</div>
<section id="reading-data-with-openxlsx" class="level3" data-number="6.1.1"><h3 data-number="6.1.1" class="anchored" data-anchor-id="reading-data-with-openxlsx">
<span class="header-section-number">6.1.1</span> Reading data with {openxlsx}</h3>
<p>Though the {readxl} package <span class="citation" data-cites="readxl">(<a href="references.html#ref-readxl" role="doc-biblioref">Wickham and Bryan 2023</a>)</span> package can be used to read Excel files stored locally, it doesn’t work for reading in Excel files directly from a URL. We could visit the relevant <a href="https://open.canada.ca/data/dataset/">open.canada.ca/data/dataset</a> website, manually download the file, and then read it in using {readxl}. Alternatively, we can use the {openxlsx} package <span class="citation" data-cites="openxlsx">(<a href="references.html#ref-openxlsx" role="doc-biblioref">Schauberger and Walker 2023</a>)</span> which allows us to pass in a URL.</p>
<p>Of course, we still need to know what the URL of this file is. If you visit the following webpage for the wind turbines data (<a href="https://open.canada.ca/data/en/dataset/79fdad93-9025-49ad-ba16-c26d718cc070">open.canada.ca/data/en/dataset/79fdad93-9025-49ad-ba16-c26d718cc070</a>), and right-click on the link to the Excel file you can then copy the link address. We save that link address as a character string called <code>url</code>. If you plan to download other datasets from the same site, it can be useful to save the main website as the <code>base_url</code> variable so that you can reuse this string later.</p>
<p>We then use the <code>read.xlsx()</code> function from {openxlsx}, where we pass in the <code>url</code> variable to the <code>xlsxFile</code> argument: </p>
<div class="cell">
<div class="sourceCode" id="cb1" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">base_url</span> <span class="op">&lt;-</span> <span class="st">"https://ftp.cartes.canada.ca/"</span></span>
<span><span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>  <span class="va">base_url</span>,</span>
<span>  <span class="st">"pub/nrcan_rncan/Wind-energy_Energie-eolienne/wind_turbines_database/Wind_Turbine_Database_FGP.xlsx"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">wind_turbines</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span>xlsxFile <span class="op">=</span> <span class="va">url</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tip-turbines-excel" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip&nbsp;6.2: Processing Excel files
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are some features of Excel files that can make them more human-friendly but less computer-friendly:</p>
<ul>
<li><p><strong>Multiple sheets</strong>: Excel files may contain multiple sheets of data. You can use the <code>sheet</code> argument in <code>read.xlsx()</code> to specify the name or index of the sheet you want to read in. Using the sheet name is usually a little bit more robust, as it means your code can withstand (accidental) changes to the order of sheets.</p></li>
<li><p><strong>Empty rows</strong>: The <code>read.xlsx()</code> function always skips empty rows at the start of the file. However, sometimes the author of the spreadsheet may add a title row then a few empty rows before the <em>real</em> data begins. You can use the <code>startRow</code> argument to specify which rows the data actually starts on.</p></li>
<li><p><strong>Merged cells</strong>: Merged cells are hard to deal with because it means your data no longer fits into a nice rectangular structure. It depends on where the merged cells are, and what they contain, how difficult they are to deal with. If they’re at the top of the file (e.g.&nbsp;with the title information) then using <code>startRow</code> might be enough. Otherwise, setting <code>fillMergedCells = TRUE</code> in <code>read.xlsx()</code> means that <em>the value in a merged cell is given to all cells within the merge</em> <span class="citation" data-cites="openxlsx">(<a href="references.html#ref-openxlsx" role="doc-biblioref">Schauberger and Walker 2023</a>)</span>.</p></li>
</ul>
</div>
</div>
<p>We don’t want to have to re-download the data from the URL each time we want to work on it (especially if the data may be updated), so let’s save a copy locally. We could simply save the Excel file (or we could have used <code><a href="https://rdrr.io/r/utils/download.file.html">download.file()</a></code> instead of <code>read_csv()</code>). However, it would be better to save it as a CSV file instead because they are smaller in size, and can be opened in a simple text editor. Luckily the <code>wind_turbines</code> data is well formatted - there are no merged cells, multiple sheets, or empty rows we need to deal with. This means we can save it as a CSV file using <code><a href="https://rdrr.io/r/utils/write.table.html">write.csv()</a></code> with an appropriate file name (and setting <code>row.names = FALSE</code> to avoid adding an additional column of row names). </p>
<div class="cell">
<div class="sourceCode" id="cb2" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">wind_turbines</span>,</span>
<span>  file <span class="op">=</span> <span class="st">"data/wind_turbines.csv"</span>,</span>
<span>  row.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then use either <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code> or <code>read_csv()</code> from {readr} to read the CSV file back in: </p>
<div class="cell">
<div class="sourceCode" id="cb3" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">wind_turbines</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"data/wind_turbines.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>wind_turbines</code> data has 6698 rows and 15 columns. The first few rows of the data are as follows:</p>
<div class="cell">
<div class="sourceCode" id="cb4" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">wind_turbines</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 6 × 15
  OBJECTID `Province/Territory` Project.name          
     &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt;                 
1        1 Alberta              Optimist Wind Energy  
2        2 Alberta              Castle River Wind Farm
3        3 Alberta              Waterton Wind Turbines
4        4 Alberta              Waterton Wind Turbines
5        5 Alberta              Waterton Wind Turbines
6        6 Alberta              Waterton Wind Turbines
# ℹ 12 more variables: `Total.project.capacity.(MW)` &lt;dbl&gt;,
#   Turbine.identifier &lt;chr&gt;,
#   Turbine.number.in.project &lt;chr&gt;,
#   `Turbine.rated.capacity.(kW)` &lt;chr&gt;,
#   `Rotor.diameter.(m)` &lt;dbl&gt;, `Hub.height.(m)` &lt;dbl&gt;,
#   Manufacturer &lt;chr&gt;, Model &lt;chr&gt;,
#   Commissioning.date &lt;chr&gt;, Latitude &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>The <code>OBJECTID</code> column is a unique row identifier. The data has a row for each wind turbine - with some of the data given on the turbine level and some data on the project level. For the variables related to project level data, this means values can be repeated multiple times within a column for turbines in the same project.</p>
<p>The <code>Province/Territory</code> column specifies which geographic region the turbine is in, with the <code>Latitude</code> and <code>Longitude</code> column giving the exact coordinates. The <code>Project.name</code> gives the name of the project that each wind turbine is associated with, and <code>Total.project.capacity.(MW)</code> the total power capacity of the project in megawatts. The <code>Turbine.identifier</code> column gives a unique ID for each turbine - it is a combination of an abbreviation of the project name, and a number identifying the number of the turbine within the project (also listed in the <code>Turbine.number.in.project</code> as a fraction of the total number of turbines per project). The capacity (in kilowatts) of each individual turbine is given in <code>Turbine.rated.capacity.(kW)</code> (adding up the individual capacities for all turbines in a project gives the value in <code>Total.project.capacity.(MW)</code> multiplied by 100).</p>
<p>The rotor diameter and hub height of each turbine are given by <code>Rotor.diameter.(m)</code> and <code>Hub.height.(m)</code>, respectively. The manufacturer and model are also given by the <code>Manufacturer</code> and <code>Model</code> columns. The commissioning date is given in the <code>Commissioning.date</code> column - it appears that some may be given on the project level, whereas others vary for turbines within a project. The <code>Notes</code> column contains free text data with additional information for some turbines. Most of these values are empty, but the column may provide information about whether the capacity of turbines have changed or assumptions about how values were calculated.</p>
</section></section><section id="exploratory-work" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="exploratory-work">
<span class="header-section-number">6.2</span> Exploratory work</h2>
<p>There are quite a few variables that we might be interested in looking at here - particularly since there are several variables about individual turbines that might be related to each other. For example, do turbines with a larger rotor diameter have a higher capacity? What is the relationship between rotor diameter and hub height? Which manufacturers are most common? Which regions have the most turbines? We might also want to look at the spatial distribution of turbines across Canada since we have the geographic coordinates - we’ll look at plotting spatial data a little bit later in <a href="doctors-ageing-population.html" class="quarto-xref"><span>Chapter 12</span></a>, <a href="time-zones.html" class="quarto-xref"><span>Chapter 13</span></a>, and <a href="us-house-elections.html" class="quarto-xref"><span>Chapter 14</span></a>.</p>
<section id="data-exploration" class="level3" data-number="6.2.1"><h3 data-number="6.2.1" class="anchored" data-anchor-id="data-exploration">
<span class="header-section-number">6.2.1</span> Data exploration</h3>
<p>Let’s start by exploring the hypothesis that wind turbines with a larger rotor diameter also have a higher capacity. We can make a scatter plot of these two variables as an initial step. The <code>Turbine.rated.capacity.(kW)</code> column is currently a character column even though it contains numeric values, so we wrap the column in <code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code> before plotting it:</p>
<div class="cell">
<div class="sourceCode" id="cb6" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">wind_turbines</span><span class="op">$</span><span class="va">`Rotor.diameter.(m)`</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">wind_turbines</span><span class="op">$</span><span class="va">`Turbine.rated.capacity.(kW)`</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Rotor diameter (m)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Turbine rated capacity (kW)"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-turbines-scatter" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-turbines-scatter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="canadian-wind-turbines_files/figure-html/fig-turbines-scatter-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-turbines-scatter-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.1: Scatter plot showing the relationship between rotor diameter and turbine capacity.
</figcaption></figure>
</div>
</div>
</div>
<p>This scatter plot highlights a few issues:</p>
<ul>
<li>
<p>We get a warning message about <code>NA</code> values.</p>
<blockquote class="blockquote">
<p><code>Warning message: In xy.coords(x, y, xlabel, ylabel, log) : NAs introduced by coercion</code></p>
</blockquote>
<p>This comes from the <code>as.numeric</code> transformation of the <code>Turbine.rated.capacity.(kW)</code> column. If we inspect this column more closely, you’ll see that there are a few unusual values such as <code>"1903/2126/2221"</code>. If we look at the <code>Notes</code> column for an explanation, we can see that these values exist because <code>"Some turbines derated such that the farm has an maximum operating capacity of 180 MW"</code>. Unfortunately, we don’t know which individual turbines this derating applies to which makes it difficult to create a scatter plot.</p>
</li>
<li><p>The other issue with this scatter plot is that many of the observations are the same, but it’s not shown clearly on the plot. If we later wanted to fit some statistical models to explore this relationship further, a common assumption is that each observation is independent. That’s not true here - many individual turbines belong to the same project, and so are the same model with the same rotor diameter and capacity. Instead, we might want to group the unique values and use the number of turbines of a particular model as a weighting. This could be better visualised as a bubble chart, with the size of the bubbles showing the number of turbines in each diameter-capacity combination.</p></li>
</ul>
<p>Let’s instead look at the number of turbines in each region, by creating an ordered bar chart. We use the <code><a href="https://rdrr.io/r/base/table.html">table()</a></code> function to get a count of the number per region, and <code><a href="https://rdrr.io/r/base/sort.html">sort()</a></code> to order the counts from smallest to largest. We then use the <code><a href="https://rdrr.io/r/graphics/barplot.html">barplot()</a></code> function to make the chart, setting <code>horiz = TRUE</code> to make the bars horizontal for easier reading.</p>
<div class="cell">
<div class="sourceCode" id="cb7" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">wind_turbines</span><span class="op">$</span><span class="va">`Province/Territory`</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co"># make labels smaller so they fit on the page</span></span>
<span>  cex.axis <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  cex.names <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  las <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  horiz <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-turbines-barplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-turbines-barplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="canadian-wind-turbines_files/figure-html/fig-turbines-barplot-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-turbines-barplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.2: Ordered bar chart showing the number of wind turbines commissioned in each province or territory.
</figcaption></figure>
</div>
</div>
</div>
<p>Most of the turbines are located in Ontario, but has this always been the case? We also have information on the commissioning date of each turbine. We could recreate this bar chart for different time periods to see how the geographic spread of turbines has changed over time. We can add <code>wind_turbines$Commissioning.date</code> into the <code><a href="https://rdrr.io/r/base/table.html">table()</a></code> function to create a stacked bar chart for each year:</p>
<div class="cell">
<div class="sourceCode" id="cb8" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span></span>
<span>    <span class="va">wind_turbines</span><span class="op">$</span><span class="va">`Province/Territory`</span>,</span>
<span>    <span class="va">wind_turbines</span><span class="op">$</span><span class="va">Commissioning.date</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># make labels smaller so they fit on the page</span></span>
<span>  cex.axis <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  cex.names <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  las <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  horiz <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-turbines-barplot-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-turbines-barplot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="canadian-wind-turbines_files/figure-html/fig-turbines-barplot-2-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-turbines-barplot-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.3: Ordered bar chart showing the number of wind turbines commissioned in time period, with stacked bars showing how many are in each province or territory.
</figcaption></figure>
</div>
</div>
</div>
<p>As you can see from the y-axis of <a href="#fig-turbines-barplot-2" class="quarto-xref">Figure&nbsp;<span>6.3</span></a>, the <code>Commissioning.date</code> isn’t always given as a year. Instead it’s sometimes given as a year range. Let’s start drafting out a more aesthetically pleasing version of this plot before we deal with processing the <code>Commissioning.date</code> data.</p>
</section><section id="exploratory-sketches" class="level3" data-number="6.2.2"><h3 data-number="6.2.2" class="anchored" data-anchor-id="exploratory-sketches">
<span class="header-section-number">6.2.2</span> Exploratory sketches</h3>
<p>There are some years for which we have very few observations, and some turbines for which we don’t know the exact year of the commissioning date. Rather than plotting the number of turbines per year, let’s plot the number of turbines. in different multi-year time periods. The choice of these time periods is open to designer choice. For this visualization, let’s start by considering four, 5-year time periods: 2000 - 2004, 2005 - 2009, 2010 - 2014, and 2015 - 2019.</p>
<p>Rather than making a stacked bar chart for each year, which can make it difficult to compare one region to another, let’s look at an alternative: a <em>waffle chart</em>. Waffle charts are sometimes referred to as <em>square pie charts</em>. Most commonly, they are visualised on a 10x10 grid, with each grid square representing 1%. The colors of the grid squares represent different categories. The advantage of waffle charts over pie charts (and to some extent bar charts), is that it’s easy for a user to read the percentages - they can simply count the squares! The disadvantage is that if there is less than 1% of values in a category, there’s no easy way to visualise this (although partially colored squares are an option). </p>
<p>Waffle charts can also be used to show counts rather than percentages. For example, each square may represent a wind turbine and the color of the square the region it is in. For example, a waffle chart of counts might look something like <a href="#fig-sketch-turbines" class="quarto-xref">Figure&nbsp;<span>6.4</span></a>.</p>
<div id="fig-sketch-turbines" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-sketch-turbines-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/sketch-turbines.png" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sketch-turbines-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.4: Initial sketch of a faceted area charts showing packages use over time
</figcaption></figure>
</div>
<p>We can make two slight variations to this basic version of the chart:</p>
<ul>
<li><p>We have 6698 observations to plot which is a lot of individual grid squares. Instead, each square may represent some number of turbines, rather than just one.</p></li>
<li><p>Instead of plotting squares, we could use icons. For example, we could plot an icon of a wind turbine. This variation of a waffle chart can be referred to as a <em>pictogram</em>. The icons can be colored based on the region in the <code>Province/Territory</code> column. Instead of using a traditional legend that takes up lots of space, we could use colored text within the subtitle as an alternative.</p></li>
</ul>
<p></p>
</section></section><section id="preparing-a-plot" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="preparing-a-plot">
<span class="header-section-number">6.3</span> Preparing a plot</h2>
<p>In order to make a draft of <a href="#fig-sketch-turbines" class="quarto-xref">Figure&nbsp;<span>6.4</span></a> using {ggplot2}, there are a few things we need to prepare:</p>
<ul>
<li>The <code>Commissioning.date</code> column needs processed to deal with the multi-year labels, and grouped into 5-year categories.</li>
<li>We need to decide how many wind turbines each icon will represent.</li>
<li>Some of the categories in the <code>Province/Territory</code> column may need grouped together because they have very small numbers, and might have less than the number of turbines represented by each icon.</li>
</ul>
<section id="data-wrangling" class="level3" data-number="6.3.1"><h3 data-number="6.3.1" class="anchored" data-anchor-id="data-wrangling">
<span class="header-section-number">6.3.1</span> Data wrangling</h3>
<p>Let’s start by dealing with the <code>Commissioning.date</code> column. There are three types of values in here:</p>
<ul>
<li>Single year e.g.&nbsp;<code>"2019"</code>: this is the ideal scenario and we don’t need to do anything.</li>
<li>Two years separated by a <code>/</code> e.g.&nbsp;<code>"2001/2003"</code>: there are several options for dealing with this. We could either take the first year, the last year, or (if they are non-consecutive years) a mid-point of the year range. Here, we’ll take the last year since this means that all wind turbines with that <code>Commissioning.date</code> will definitely have been commissioned by that date.</li>
<li>Three years separated by a <code>"/"</code> e.g.&nbsp;<code>"2005/2006/2012"</code>: this is more again more complex, but we’ll take the last year for the same reasons as above.</li>
</ul>
<p>Essentially, this means that:</p>
<ul>
<li>If there is no <code>"/"</code> in the <code>Commissioning.date</code>, we do nothing.</li>
<li>If there is one or more <code>"/"</code> in the <code>Commissioning.date</code>, we extract whatever comes after the last one.</li>
</ul>
<p>Let’s make a function that does exactly that, called <code>extract_after_last_slash()</code>. The input this function is a vector of character strings. We start by checking which elements of the input contain a <code>"/"</code> using <code>str_detect()</code> from the {stringr} package <span class="citation" data-cites="stringr">(<a href="references.html#ref-stringr" role="doc-biblioref">Wickham 2023</a>)</span>. We then use <code>str_match()</code> from {stringr} in combination with a regular expression to extract the element after the last <code>"/"</code>. If there is no <code>"/"</code>, the output will be <code>NA</code>. The <code>str_match()</code> function returns a matrix with the same number of rows as the length of the input, where the first column is the complete match i.e.&nbsp;the input. The second column contains the output we want so we use <code>[, 2]</code> to extract it. Finally, we use <code>if_else()</code> from {dplyr}, to if there was a <code>"/"</code> then use the output from <code>str_match()</code>, otherwise keep the original value. </p>
<div class="cell">
<div class="sourceCode" id="cb9" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">extract_after_last_slash</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">texts</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">has_slash</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">texts</span>, <span class="st">"/"</span><span class="op">)</span></span>
<span>  <span class="va">extracted</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_match.html">str_match</a></span><span class="op">(</span><span class="va">texts</span>, <span class="st">".*/(.*)$"</span><span class="op">)</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">has_slash</span>, <span class="va">extracted</span>, <span class="va">texts</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tip-turbines-ifelse" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip&nbsp;6.3: Comparing <code>if_else()</code> and <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’ve used the <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> function in base R before, you might be wondering why there’s a very similarly named function in {dplyr} and what’s different about it.</p>
<p>The main difference is that <code>if_else()</code> is a bit more strict about checking whether you’re doing what you think you’re doing. For example, let’s say we have a vector <code>x</code> of length 4 and we want to replace the values in <code>x</code> that are equal to 0 with something else. If that replacement is of length 3, that doesn’t really make sense. Which value in the vector of length 3 should it use? The <code>if_else()</code> function highlights this issue with an error, the <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> function quietly uses the value in the same position.</p>
<div class="cell">
<div class="sourceCode" id="cb10" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre data-code-line-numbers=""><code>Error in `dplyr::if_else()`:
! `true` must have size 4, not size 3.</code></pre>
</div>
<div class="sourceCode" id="cb12" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>[1] 1 5 2 3</code></pre>
</div>
</div>
<p>The <code>if_else()</code> function from {dplyr} also preserves types. If you put a <code>Date</code> into <code>if_else()</code>, then a <code>Date</code> is what comes out. That’s not always true with <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code>. </p>
</div>
</div>
<p>Now, let’s use our new <code>extract_after_last_slash()</code> function! Let’s start by using <code>select()</code> to keep only the columns we actually need: <code>Province/Territory</code>, and <code>Commissioning.date</code>. We then create a new column called <code>Year</code> which is the output of applying the <code>extract_after_last_slash()</code> to the <code>Commissioning.date</code> column. Initally, this column is still a character string so we convert is to a number using <code><a href="https://rdrr.io/r/base/numeric.html">as.numeric()</a></code>: </p>
<div class="cell">
<div class="sourceCode" id="cb14" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">turbines_year</span> <span class="op">&lt;-</span> <span class="va">wind_turbines</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">`Province/Territory`</span>, <span class="va">Commissioning.date</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    Year <span class="op">=</span> <span class="fu">extract_after_last_slash</span><span class="op">(</span><span class="va">Commissioning.date</span><span class="op">)</span>,</span>
<span>    Year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s group the new <code>Year</code> column into categories. Our categories span 2000 to 2019, so we start by filtering out any rows that don’t fit into this time frame using <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> from {dplyr}. We then use <code>case_when()</code> from {dplyr} to actually construct the categories. Here, we make use of the <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> function. The <code>seq(2000, 2004)</code> code creates a vector <code>2000 2001 2002 2003 2004</code>. If any the <code>Year</code> is equal to any of those values, then it goes into the <code>"2000 - 2004"</code> category. And so on. Although R will automatically sort the year categories in the correct order since, in this case, the alphabetical order happens to match the desired order. However, it’s good practice to be explicit about what order the categories should have, so we can also set <code>Year_Group</code> to be a factor and specify the correct order. </p>
<div class="cell">
<div class="sourceCode" id="cb15" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">turbines_year_group</span> <span class="op">&lt;-</span> <span class="va">turbines_year</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">&gt;=</span> <span class="fl">2000</span> <span class="op">&amp;</span> <span class="va">Year</span> <span class="op">&lt;=</span> <span class="fl">2019</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    Year_Group <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">Year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">2004</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2000 - 2004"</span>,</span>
<span>      <span class="va">Year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2005</span>, <span class="fl">2009</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2005 - 2009"</span>,</span>
<span>      <span class="va">Year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2010</span>, <span class="fl">2014</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2010 - 2014"</span>,</span>
<span>      <span class="va">Year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2019</span><span class="op">)</span> <span class="op">~</span> <span class="st">"2015 - 2019"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    Year_Group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Year_Group</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"2000 - 2004"</span>, <span class="st">"2005 - 2009"</span>, <span class="st">"2010 - 2014"</span>, <span class="st">"2015 - 2019"</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at the <code>Province/Territory</code> categories. Using <code>count()</code> and <code>arrange()</code> from {dplyr}, shows us that there is a big imbalance between the categories: </p>
<div class="cell">
<div class="sourceCode" id="cb16" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">turbines_year_group</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">`Province/Territory`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code># A tibble: 12 × 2
   `Province/Territory`          n
   &lt;chr&gt;                     &lt;int&gt;
 1 Ontario                    2662
 2 Quebec                     1859
 3 Alberta                     895
 4 Nova Scotia                 310
 5 British Columbia            292
 6 Saskatchewan                153
 7 Manitoba                    133
 8 New Brunswick               119
 9 Prince Edward Island        104
10 Newfoundland and Labrador    27
11 Northwest Territories         4
12 Yukon                         1</code></pre>
</div>
</div>
<p>First, let’s rename the <code>Province/Territory</code> column to <code>Region</code> - a shorter name that will make it a little bit easier to work with. As well as the issue posed by small numbers in categories, twelve categories is also a fairly large number to visualize. We might choose to group together the six smallest categories. The choice of six is fairly arbitrary - but we want a balance between lots of categories with small numbers and few categories with very high numbers. We use <code>mutate()</code> and <code>case_when()</code> again, to change the value in <code>Region</code> to <code>"other"</code> when the region is one of the six specified values. </p>
<p>Then, we count up how many turbines were commissioned in each <code>Year_Group</code> and <code>Region</code> combination using <code>count()</code>. We also need to decide how many turbines each icon will represent. It will take a little bit of trial and error to decide on this value - depending on what resolution you want, and how big your final plot will be. Here, we used <code>20</code>. This means we divide the turbine count by <code>20</code> to obtain the number of icons required, rounding the values as we can only have whole icons. </p>
<p>We filter out any rows where the rounded count is <code>0</code> since these won’t be plotted. As an aside, it’s important to think about these values before we simply throw them away. For example, a region which had 9 turbines in a particular time period won’t show up on this plot - since <code>9/20</code> is less than 0.5 and so is rounded to <code>0</code>. This is an unfortunate limitation of this type of waffle plot variation. </p>
<div class="cell">
<div class="sourceCode" id="cb18" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">turbines_region</span> <span class="op">&lt;-</span> <span class="va">turbines_year_group</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Region <span class="op">=</span> <span class="va">`Province/Territory`</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    Region <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">Region</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Northwest Territories"</span>,</span>
<span>        <span class="st">"Newfoundland and Labrador"</span>,</span>
<span>        <span class="st">"Prince Edward Island"</span>,</span>
<span>        <span class="st">"New Brunswick"</span>,</span>
<span>        <span class="st">"Manitoba"</span>,</span>
<span>        <span class="st">"Saskatchewan"</span></span>
<span>      <span class="op">)</span> <span class="op">~</span> <span class="st">"other"</span>,</span>
<span>      <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">Region</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">Region</span>, <span class="va">Year_Group</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>Region</code> variable will be plotted alphabetically be default, but this is rarely the most useful ordering. Instead, let’s order by magnitude - with the exception of putting the <code>"other"</code> category last.</p>
<p>We start by using the <code>summarise()</code> function to add up the number of turbines across the different time periods, getting a total per <code>Region</code>. We then <code>arrange()</code> them in a descending order (not the <code>-</code> in front of the <code>n</code>). We then <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> out the <code>"other"</code> category and stick it on the end after extracting the <code>Region</code> column using <code>pull()</code>. </p>
<div class="cell">
<div class="sourceCode" id="cb19" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">region_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">turbines_region</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>, .by <span class="op">=</span> <span class="va">Region</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Region</span> <span class="op">!=</span> <span class="st">"other"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">Region</span><span class="op">)</span>, <span class="st">"other"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s apply these new factor levels to the <code>Region</code> column using <code>mutate()</code>. Due to a <em>quirk</em> of the {waffle} package <span class="citation" data-cites="waffle">(<a href="references.html#ref-waffle" role="doc-biblioref">Rudis and Gandy 2023</a>)</span> that we’ll be using to make our plot (it plots data in the order it appears in the dataset, rather than according to the factor levels), we also sort the data using <code>arrange()</code> from {dplyr}. </p>
<div class="cell">
<div class="sourceCode" id="cb20" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">turbines_region</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    Region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Region</span>, levels <span class="op">=</span> <span class="va">region_levels</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Region</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our data is now ready for us to plot!</p>
</section><section id="installing-font-awesome-fonts" class="level3" data-number="6.3.2"><h3 data-number="6.3.2" class="anchored" data-anchor-id="installing-font-awesome-fonts">
<span class="header-section-number">6.3.2</span> Installing Font Awesome fonts</h3>
<p>Before we jump into plotting, we need to do one more thing. In <a href="#fig-sketch-turbines" class="quarto-xref">Figure&nbsp;<span>6.4</span></a>, we decided we would use icons in the waffle chart instead of just colored grid squares. So we need to find a way of using icons in R.</p>
<p>In <a href="programming-languages.html" class="quarto-xref"><span>Chapter 2</span></a>, we saw how to load fonts into R using the {sysfonts} and {showtext} packages. Luckily, we can use a similar process here to load in an icon font. <a href="https://fontawesome.com/">Font Awesome</a> is a popular icon toolkit that provides scalable vector icons and social logos (more on this in <a href="cats.html" class="quarto-xref"><span>Chapter 7</span></a>) <span class="citation" data-cites="fontawesome">(<a href="references.html#ref-fontawesome" role="doc-biblioref">Font Awesome 2024</a>)</span>. You can download font files containing the freely available icons at <a href="https://fontawesome.com/download">fontawesome.com/download</a>, selecting the <strong>Free for Desktop</strong> option. This will download a zip file containing several font files. For this chart, we only need one of those files <code>Font-Awesome-6-Free-Solid-900.otf</code>. Save this <code>.otf</code> file somewhere you can find it again - such as in a project folder called <code>fonts</code>.</p>
<p>Then, we’ll use <code>font_add()</code> from {sysfonts} <span class="citation" data-cites="sysfonts">(<a href="references.html#ref-sysfonts" role="doc-biblioref">Qiu and See file AUTHORS for details. 2022</a>)</span> to load the font into R. The <code>family</code> argument is what we want to refer to the font as in R. The <code>regular</code> argument is the file path to the <code>.otf</code> file. We then use <code>showtext_auto()</code> and <code>showtext_opts()</code> in exactly the same way as we did for <a href="programming-languages.html" class="quarto-xref"><span>Chapter 2</span></a>, to use {showtext} to render the text. </p>
<div class="cell">
<div class="sourceCode" id="cb21" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">sysfonts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sysfonts/man/font_add.html">font_add</a></span><span class="op">(</span></span>
<span>  family <span class="op">=</span> <span class="st">"Font Awesome 6"</span>,</span>
<span>  regular <span class="op">=</span> <span class="st">"fonts/Font-Awesome-6-Free-Solid-900.otf"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">showtext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_auto.html">showtext_auto</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">showtext</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/showtext/man/showtext_opts.html">showtext_opts</a></span><span class="op">(</span>dpi <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tip-turbines-open" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip&nbsp;6.4: Installing Font Awesome icons with {waffle}
</div>
</div>
<div class="callout-body-container callout-body">
<p>The {waffle} package comes bundled with Font Awesome 5, and you can use the <code>install_fa_fonts()</code> function to help you install the font, as an alternative to approach described here. </p>
<p>Downloading and installing using the <code>font_add()</code> approach will give you access to a wider range of icons since it used the more recent <strong>Font Awesome 6</strong> fonts, and means you don’t have to install the font system wide - you only need to load it into R.</p>
</div>
</div>
<p>Now we’re ready to plot!</p>
</section><section id="the-first-plot-with-waffle" class="level3" data-number="6.3.3"><h3 data-number="6.3.3" class="anchored" data-anchor-id="the-first-plot-with-waffle">
<span class="header-section-number">6.3.3</span> The first plot with {waffle}</h3>
<p>We’re going to use the {waffle} package <span class="citation" data-cites="waffle">(<a href="references.html#ref-waffle" role="doc-biblioref">Rudis and Gandy 2023</a>)</span> to create our plot. Though the package includes the <code>waffle()</code> function which allows you to create a waffle chart directly from a <code>data.frame</code>, it also include <code>geom</code> functions to allow you to build charts in the way you normally would with {ggplot2}. The <code>geom_waffle()</code> function can be used to build traditional waffle charts with grid squares, and the <code>geom_pictogram()</code> function is used for waffle charts with icons i.e.&nbsp;pictograms. We’ll use <code>geom_pictogram()</code>. This means we start our plot as we normally do, by passing our data into <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>. </p>
<p>We then edit the aesthetic mapping in the <code>geom_pictogram()</code> function, where we specify the <code>label</code> and <code>color</code> - both mapped to the <code>Region</code> column. This might seem slightly unusual because we don’t want to icon to vary with region - want to use the same icon for all categories. However, <code>geom_pictogram()</code> expects <code>label</code> to vary by category, so we map it to region and we’ll later use <code>scale_label_pictogram()</code> to make them all the same icon. <code>values</code> is also a required aesthetic - we use the <code>n</code> column in the data to specify how many icons should be plotted for each category. The x and y coordinates are automatically calculated when we use the <code>geom_pictogram()</code> function so we don’t need to map these out in the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> function. </p>
<p>We also edit a few other parameters of the <code>geom_pictogram()</code> function. By default, pictograms are stacked horizontally as this is often easier to read (similar to horizontal bar charts). However, it’s also very common to put date variables on the x-axis. Setting <code>flip = TRUE</code> will stack the pictogram categories upwards, and allow the date categories to go on the x-axis. Setting <code>n_rows = 10</code> means that each row of the pictogram will contain 10 icons (remember that we’ve flipped rows and columns here). We can edit the <code>size</code> of the icons in the same way we would edit the font size in <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text()</a></code>, for example. It might take a little bit of trial and error to find the right size to make sure icons are large enough to see, but don’t overlap. We also need to state that the icons come from the Font Awesome 6 font by setting <code>family = "Font Awesome 6"</code> (the same name as the <code>family</code> argument used in <code>font_add()</code>). </p>
<p>Finally, we add <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code> to create a pictogram for each date range, placing them in a single row, and moving the facet label to the bottom of the chart. </p>
<div class="cell">
<div class="sourceCode" id="cb22" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">base_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">waffle</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/waffle/man/geom_pictogram.html">geom_pictogram</a></span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      label <span class="op">=</span> <span class="va">Region</span>,</span>
<span>      color <span class="op">=</span> <span class="va">Region</span>,</span>
<span>      values <span class="op">=</span> <span class="va">n</span></span>
<span>    <span class="op">)</span>,</span>
<span>    flip <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    n_rows <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    size <span class="op">=</span> <span class="fl">2.5</span>,</span>
<span>    family <span class="op">=</span> <span class="st">"Font Awesome 6"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Year_Group</span>, nrow <span class="op">=</span> <span class="fl">1</span>, strip.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span>
<span><span class="va">base_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-turbines-base-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-turbines-base-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="canadian-wind-turbines_files/figure-html/fig-turbines-base-plot-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-turbines-base-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.5: Pictogram showing the number of turbines per time period in each region, where the region name is showing instead of the icons.
</figcaption></figure>
</div>
</div>
</div>
<div id="tip-turbines-waffle-prop" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip&nbsp;6.5: Proportional waffle charts
</div>
</div>
<div class="callout-body-container callout-body">
<p>By default, <code>geom_pictogram()</code> and <code>geom_waffle()</code> both assume that the column mapped to <code>values</code> should be plotted as counts. If you’d prefer to plot the values as percentages, set <code>make_proportional = TRUE</code>.</p>
</div>
</div>
<p>What you might immediately notice about <a href="#fig-turbines-base-plot" class="quarto-xref">Figure&nbsp;<span>6.5</span></a> is that there are no icons. Instead, the plot has printed the <code>Region</code> names (even though we’ve set <code>family = "Font Awesome 6"</code>). This is because we haven’t defined which icons we want to use. To find an appropriate icon and what it’s called, we can browse the Font Awesome website at <a href="https://fontawesome.com/search">fontawesome.com/search</a> and search for related icons. For example, we might search for a <em>wind turbine</em> icon. Though Font Awesome wind turbine icons do exist, they are unfortunately only available with the Pro version. There are other free icons that sort of fit this theme: <code>wind</code>, <code>bolt</code> (to represent energy), or <code>fan</code> to name a few. We’ll use <code>fan</code> <span class="citation" data-cites="fontawesome">(<a href="references.html#ref-fontawesome" role="doc-biblioref">Font Awesome 2024</a>)</span>.</p>
<p>We can add <code>scale_label_pictogram()</code> from {waffle} to our plot to specify the icons. We would normally pass in a vector of icon names to the <code>values</code> argument - one icon for each category. However, since we want to use the same icon for all categories, we can simply pass in a single name - taking advantage of the fact that R re-uses elements of vectors. We set <code>guide = "none"</code> to remove the legend for icons as they are all the same. Alternatively, you can later set <code>theme(legend.position = "none")</code> as we did in previous chapters to remove the legend. </p>
<div class="cell">
<div class="sourceCode" id="cb23" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">icons_plot</span> <span class="op">&lt;-</span> <span class="va">base_plot</span> <span class="op">+</span></span>
<span>  <span class="fu">waffle</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/waffle/man/scale_label_pictogram.html">scale_label_pictogram</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="st">"fan"</span>,</span>
<span>    guide <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">icons_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-turbines-icons-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-turbines-icons-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="canadian-wind-turbines_files/figure-html/fig-turbines-icons-plot-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-turbines-icons-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.6: Pictogram showing the number of turbines per time period in each region, with fan icons indicating 20 turbines currently looking overcrowded.
</figcaption></figure>
</div>
</div>
</div>
<p>You might also have noticed that the values on the y-axis are incorrect - there definitely more than 15 turbines in the 2010 - 2014 time frame! We’ll deal with the axis in the next section.</p>
</section></section><section id="advanced-styling" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="advanced-styling">
<span class="header-section-number">6.4</span> Advanced styling</h2>
<p>Now we still need to edit the colors used in the plot, add a title and subtitle (including colored text to replace the legend), and edit the axis labels.</p>
<section id="colors-with-rcartocolor" class="level3" data-number="6.4.1"><h3 data-number="6.4.1" class="anchored" data-anchor-id="colors-with-rcartocolor">
<span class="header-section-number">6.4.1</span> Colors with {rcartocolor}</h3>
<div class="cell">
<div class="sourceCode" id="cb24" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bg_col</span> <span class="op">&lt;-</span> <span class="st">"#fafafa"</span></span>
<span><span class="va">text_col</span> <span class="op">&lt;-</span> <span class="st">"black"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s also define a color palette that we’ll use for the color of the icons. We’re looking for 6 different colors - one for area. The {rcartocolor} <span class="citation" data-cites="rcartocolor">(<a href="references.html#ref-rcartocolor" role="doc-biblioref">Nowosad 2018</a>)</span> package provides access to the <a href="https://carto.com/carto-colors/">CARTOColors</a> color palettes for maps designed by <a href="https://carto.com/">CARTO</a> <span class="citation" data-cites="cartocolors">(<a href="references.html#ref-cartocolors" role="doc-biblioref">CARTO 2016</a>)</span>. Although these palettes were primarily designed for coloring maps, the color palettes are also very effective for other types of graphics.</p>
<p>In the {rcartocolor} package, categorical palettes are referred to as <em>qualitative</em> palettes. We can see all available qualitative palettes with a sufficient number of colors using <code>display_carto_all()</code>: </p>
<div class="cell">
<div class="sourceCode" id="cb25" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">rcartocolor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rcartocolor/man/display_carto_all.html">display_carto_all</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">6</span>, type <span class="op">=</span> <span class="st">"qualitative"</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-turbines-rcarto" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-turbines-rcarto-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="canadian-wind-turbines_files/figure-html/fig-turbines-rcarto-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-turbines-rcarto-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.7: All qualitative color palettes with at least 6 colors in the {rcartocolor} package.
</figcaption></figure>
</div>
</div>
</div>
<p>Although the {rcartocolor} package has the <code>scale_fill_carto_d()</code> which we could use directly in our plots, we’ll still save the color palette as a vector of hex codes to allow us to re-use the colors more easily. As you can see in <a href="#fig-turbines-rcarto" class="quarto-xref">Figure&nbsp;<span>6.7</span></a>, in the qualitative palettes in the {rcartocolor} package, the last color is often a gray color. That’s a great choice for representing missing data, but when we want different colors for categories it doesn’t work as well. The trick is to ask for one more color than we need, and then throw away the last element in the color palette. We have 6 categories in our plot, so we ask for 7 colors using the <code>carto_pal()</code> function and then extract only the first 6. We’ll use the <code>"Vivid"</code> palette here. </p>
<p>We also make the <code>col_palette</code> vector a named vector by using the <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> function, and using <code>region_levels</code> as the names. Although this isn’t necessary for adding the colors to the plot, it will make it easier to extract the colors and ensure each color is mapped to the correct category label.</p>
<div class="cell">
<div class="sourceCode" id="cb26" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">col_palette</span> <span class="op">&lt;-</span> <span class="fu">rcartocolor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rcartocolor/man/carto_pal.html">carto_pal</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">Region</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"Vivid"</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">Region</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">col_palette</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">region_levels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then pass this <code>col_palette</code> vector into <code><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual()</a></code> to apply the colors to our plot. Since we’ll be using colored text instead of a traditional legend, we set <code>guide = "none"</code> to remove the legend again. </p>
<div class="cell">
<div class="sourceCode" id="cb27" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">col_plot</span> <span class="op">&lt;-</span> <span class="va">icons_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="va">col_palette</span>,</span>
<span>    guide <span class="op">=</span> <span class="st">"none"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="adding-styled-text-with-marquee" class="level3" data-number="6.4.2"><h3 data-number="6.4.2" class="anchored" data-anchor-id="adding-styled-text-with-marquee">
<span class="header-section-number">6.4.2</span> Adding styled text with {marquee}</h3>
<p>We’ve already seen in <a href="programming-languages.html" class="quarto-xref"><span>Chapter 2</span></a> and <a href="uk-museums.html" class="quarto-xref"><span>Chapter 3</span></a> how to format the title or subtitle text to be bold using the <code>face = "bold"</code> argument inside <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> elements. But what if we want to make only <em>part</em> of the text bold? We can use the {marquee} package <span class="citation" data-cites="marquee">(<a href="references.html#ref-marquee" role="doc-biblioref">Pedersen and Mitáš 2024</a>)</span> to add styling to text within in a string. The {marquee} package allows you to use Markdown syntax in text when you’re making graphics in R, including in plots built with {ggplot2} or other graphics built on {grid}. </p>
<p>In Markdown, to make text bold, you enclose it inside two pairs of asterisks e.g.&nbsp;<code>**bold text**</code>. For example, if we wanted to put the entire title in bold font, we could write the title inside <code>**</code>. In the caption, we might want to embolden the words <code>Data</code> and <code>Graphic</code> to highlight that there are two different fields of information:</p>
<div class="cell">
<div class="sourceCode" id="cb28" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">title</span> <span class="op">&lt;-</span> <span class="st">"**Canadian wind turbines are mostly found in Ontario**"</span></span>
<span><span class="va">cap</span> <span class="op">&lt;-</span> <span class="st">"**Data**: Natural Resources Canada | **Graphic**: N. Rennie"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This type of formatting for the plot caption is something that we might like to re-use across multiple plots. And when we want to re-use code, it’s almost always useful to make it into a function. Let’s define a function called <code>source_caption()</code> which has three arguments:</p>
<ul>
<li>
<code>source</code>: a character string for the source of the data</li>
<li>
<code>graphic</code>: a character string for the attribution of the visualization</li>
<li>
<code>sep</code>: a character string for what should separate the two pieces of text, which has <code>" | "</code> as a default.</li>
</ul>
<p>We then use <code>glue()</code> from {glue} to stick these three arguments together, and include the bold formatting using <code>**</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb29" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">source_caption</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">source</span>, <span class="va">graphic</span>, <span class="va">sep</span> <span class="op">=</span> <span class="st">" | "</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">caption</span> <span class="op">&lt;-</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span></span>
<span>    <span class="st">"**Data**: {source}{sep}**Graphic**: {graphic}"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">caption</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can construct the caption using our new <code>source_caption()</code> function:</p>
<div class="cell">
<div class="sourceCode" id="cb30" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cap</span> <span class="op">&lt;-</span> <span class="fu">source_caption</span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"Natural Resources Canada"</span>,</span>
<span>  graphic <span class="op">=</span> <span class="st">"N. Rennie"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">cap</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>**Data**: Natural Resources Canada | **Graphic**: N. Rennie</code></pre>
</div>
</div>
<p>You can see that it’s identical to the one we manually created earlier. We’ll also re-use the <code>source_caption()</code> function in later chapters.</p>
<p>Let’s move onto the subtitle. In this visualization, the subtitle will also be doubling as a legend as we’ll use colored text to denote the different categories. In {marquee}, text can be colored by wrapping the text in curly brackets, where the first word is pre-fixed by a period and identifies the color of the text i.e.&nbsp;<code>{.color text to color}</code>. For example, <code>{.red This is red text.}</code>.</p>
<p>We want to add the colors and the text to be colored in a programmatic way. We’ll use square brackets to subset the values and names stored in the <code>col_palette</code> vector. Here, <code>col_palette[[1]]</code> extracts the hex code for the color of the first category, and <code>names(col_palette)[[1]]</code> extracts the name of the first category.</p>
<p>Normally, when we want to write character strings and insert variables into the string, we’d use <code>glue()</code> to combine them. However, the <code><a href="https://rdrr.io/r/base/Paren.html">{}</a></code> that we normally use for variables in <code>glue()</code> will get mixed up with the <code><a href="https://rdrr.io/r/base/Paren.html">{}</a></code> we’ll use for text formatting with {marquee}. There are a couple of different ways we can get around this problem. One way is changing the delimiters used in <code>glue()</code>. For example, by setting <code>.open = "["</code> and <code>.close = "]"</code> inside the <code>glue()</code> function. Alternatively, we can use <code>marquee_glue()</code> from the {marquee} package - an equivalent version of <code>glue()</code> that was built to deal with this problem.</p>
<div class="cell">
<div class="sourceCode" id="cb32" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">st</span> <span class="op">&lt;-</span> <span class="fu">marquee</span><span class="fu">::</span><span class="fu"><a href="https://marquee.r-lib.org/reference/marquee_glue.html">marquee_glue</a></span><span class="op">(</span></span>
<span>  <span class="st">"The Canadian Wind Turbine Database contains the geographic location and key technology details for wind turbines installed in Canada. It includes information about turbines installed in {.{col_palette[[1]]} {names(col_palette)[[1]]}}, {.{col_palette[[2]]} {names(col_palette)[[2]]}}, {.{col_palette[[3]]} {names(col_palette)[[3]]}}, {.{col_palette[[4]]} {names(col_palette)[[4]]}}, {.{col_palette[[5]]} {names(col_palette)[[5]]}}, and {.{col_palette[[6]]} {names(col_palette)[[6]]}} regions."</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see what our subtitle looks like when the variables have been evaluated:</p>
<div class="cell">
<div class="sourceCode" id="cb33" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">st</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre data-code-line-numbers=""><code>The Canadian Wind Turbine Database contains the geographic location and key technology details for wind turbines installed in Canada. It includes information about turbines installed in {.#E58606 Ontario}, {.#5D69B1 Quebec}, {.#52BCA3 Alberta}, {.#99C945 Nova Scotia}, {.#CC61B0 British Columbia}, and {.#24796C other} regions.</code></pre>
</div>
</div>
<p>This is the reason that we wanted the <code>"other"</code> category to be in lower case and in last position when constructing <code>region_levels</code> - to make the sentence read better.</p>
<p>We add these text elements to out plot in the normal way, by passing them into the <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> function: </p>
<div class="cell">
<div class="sourceCode" id="cb35" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">text_plot</span> <span class="op">&lt;-</span> <span class="va">col_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="va">title</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="va">st</span>,</span>
<span>    caption <span class="op">=</span> <span class="va">cap</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">text_plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-turbines-text-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-turbines-text-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="canadian-wind-turbines_files/figure-html/fig-turbines-text-plot-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-turbines-text-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.8: Pictogram showing the number of turbines per time period in each region, with title and caption text showing asterisks that indicate bold text.
</figcaption></figure>
</div>
</div>
</div>
<p>You’ll notice that the formatting hasn’t been applied, and that the <code>**</code> have been rendered literally. We’ll deal with this when we edit the arguments in <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> - we haven’t actually used {marquee} yet to format the title text!</p>
</section><section id="adjusting-scales-and-themes" class="level3" data-number="6.4.3"><h3 data-number="6.4.3" class="anchored" data-anchor-id="adjusting-scales-and-themes">
<span class="header-section-number">6.4.3</span> Adjusting scales and themes</h3>
<p>We can make a final few tweaks to our plot, to apply the formatting with {marquee} and make it look a little bit cleaner. Let’s start by adjusting the scales. At the moment, the y-axis ranges from 0 to around 15. We know this isn’t correct because we have over 6,500 observations in our data. There are two reasons why the scale of the y-axis is incorrect:</p>
<ul>
<li>Each icon represents 20 turbines, so the y-axis labels are currently showing as 20 times smaller than they should be.</li>
<li>Within each facet, we row contains 10 icons, so the y-axis labels are currently showing as another 10 times smaller than they should be.</li>
</ul>
<p>Let’s fix that by passing a function into the <code>labels</code> argument of <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous()</a></code>. The function takes the existing y-axis label, multiplies it by <code>10</code>, multiplies it by <code>20</code>, and formats it using a thousand separator comma. We set <code>expand = c(0, 0)</code> to remove the extra space at the top and bottom of the y-axis. Let’s also choose slightly nicer break points for the y-axis - ranging from 0 to 4,000 with breaks every 1,000. Unfortunately, we need to specify the limits and the breaks on the original scale rather than on the label scale e.g.&nbsp;an break point of <code>15</code> is actually a break point of <code>15 * 20 * 10 = 3000</code>. Adding <code><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed()</a></code> helps to deal with the overlapping icons issue, by making each icon area square. </p>
<div class="cell">
<div class="sourceCode" id="cb36" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scale_plot</span> <span class="op">&lt;-</span> <span class="va">text_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">*</span> <span class="fl">20</span>, big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span>,</span>
<span>    expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s make a few final edits to tidy up our plot by editing the theme. We’ll use <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal()</a></code> as a base theme (making the font size a little bit smaller), and then make a few further edits using the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> arguments. </p>
<p>Within <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code>, we start by setting <code>plot.title.position</code> and <code>plot.caption.position</code> to <code>"plot"</code> to align the title, subtitle, and caption text with the edge of the whole plot, rather than the start of the first panel. Some additional spacing around the edge of the plot is added using <code>plot.margin</code> and the background color is edited by using the <code>fill</code> and <code>color</code> arguments in <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect()</a></code> for the <code>plot.background</code> argument. The gridlines are also made slightly thinner by adjusting <code>panel.grid.major</code>. </p>
<p>Finally, we edit the plot, subtitle, and caption elements and specify them all using <code>element_marquee()</code>. By using <code>element_marquee()</code>, the Markdown syntax we’ve applied, such as the bold and colored text, will be rendered correctly. You can adjust the <code>color</code>, <code>size</code>, <code>margin</code> and <code>hjust</code> of {marquee} text in the same way you would with <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text()</a></code>. If you have some elements of the text rendered with <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text()</a></code> and some rendered with <code>element_marquee()</code>, you may notice some differences in the text sizing and spacing. Try setting the size of individual elements with the <code>size</code> argument. </p>
<p>The <code>width</code> argument applies text wrapping, where <code>width = 1</code> means the text wraps to the full width of the plot. This is similar to the way that <code>element_textbox_simple()</code> from {ggtext} works. However, the <code>width</code> is not set by default, so if you want the text to wrap it’s important to specify the width.</p>
<div id="tip-turbines-marquee-req" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip&nbsp;6.6: Requirements for using {marquee}
</div>
</div>
<div class="callout-body-container callout-body">
<p>The {marquee} package relies on some of the more recent features in the R graphics engine. This means that you need at least version 4.3 of R for {marquee} text to render correctly. Not all graphics devices support these new features (especially in Windows) so you might need to adjust the graphics device that R uses. The devices made available through the {ragg} package <span class="citation" data-cites="ragg">(<a href="references.html#ref-ragg" role="doc-biblioref">Pedersen and Shemanarev 2023</a>)</span> are a good choice.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb37" data-source-line-numbers="nil" data-code-line-numbers="nil"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">scale_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span></span>
<span>    base_size <span class="op">=</span> <span class="fl">8</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    <span class="co"># spacing around text and plot</span></span>
<span>    plot.title.position <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>    plot.caption.position <span class="op">=</span> <span class="st">"plot"</span>,</span>
<span>    plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>    <span class="co"># background and grid lines</span></span>
<span>    plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span></span>
<span>      fill <span class="op">=</span> <span class="va">bg_col</span>, color <span class="op">=</span> <span class="va">bg_col</span></span>
<span>    <span class="op">)</span>,</span>
<span>    panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span></span>
<span>      linewidth <span class="op">=</span> <span class="fl">0.4</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="co"># format text with {marquee}</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu">marquee</span><span class="fu">::</span><span class="fu"><a href="https://marquee.r-lib.org/reference/element_marquee.html">element_marquee</a></span><span class="op">(</span></span>
<span>      color <span class="op">=</span> <span class="va">text_col</span>,</span>
<span>      width <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">12</span>,</span>
<span>      margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span>b <span class="op">=</span> <span class="op">-</span><span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    plot.subtitle <span class="op">=</span> <span class="fu">marquee</span><span class="fu">::</span><span class="fu"><a href="https://marquee.r-lib.org/reference/element_marquee.html">element_marquee</a></span><span class="op">(</span></span>
<span>      color <span class="op">=</span> <span class="va">text_col</span>,</span>
<span>      width <span class="op">=</span> <span class="fl">1</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">9</span></span>
<span>    <span class="op">)</span>,</span>
<span>    plot.caption <span class="op">=</span> <span class="fu">marquee</span><span class="fu">::</span><span class="fu"><a href="https://marquee.r-lib.org/reference/element_marquee.html">element_marquee</a></span><span class="op">(</span></span>
<span>      hjust <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      lineheight <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">8</span>,</span>
<span>      margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-turbines-theme-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-turbines-theme-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="canadian-wind-turbines_files/figure-html/fig-turbines-theme-plot-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-turbines-theme-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6.9: Pictogram showing the number of turbines per time period in each region, with colored text in the subtitle indicating which color maps to each region.
</figcaption></figure>
</div>
</div>
</div>
<p>And we’re done!</p>
</section></section><section id="reflection" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="reflection">
<span class="header-section-number">6.5</span> Reflection</h2>
<p>The colored subtitle as an alternative to a legend is effective because it uses much less space than a traditional legend - leaving more room for the data. However, there are some elements of the subtitle that could still be improved. We’ve discussed already the limitations of waffle plots and pictograms in terms of the lack of representation of categories with small numbers. This means that we had to group some regions together, and so regions with fewer turbines have less information included in the chart. Perhaps the subtitle could be updated to explain to users that each icon represents 20 turbines, and that this means regions with 10 or fewer turbines are not represented.</p>
<p>There’s also some uncertainty around the date used, which isn’t really explained in the chart. When processing the <code>Commissioning.date</code> column, we used the most recent date but that isn’t necessarily always the best choice. A limitation of the data is that we also only have commissioning date, not installation date or date of first operation. This means that perhaps there are some values in the data that suggest a turbine exists in one time period when it hasn’t yet been built.</p>
<p>Finally, we’ve used a <code>fan</code> icon because the Font Awesome wind turbine icon is only available in the Pro version. Using a wind turbine icon would be much clearer, and more consistent with the theme of the plot. We could look at using an alternative icon font, or we could perhaps use images instead. See <a href="other-tricks.html#sec-ggbuild" class="quarto-xref"><span>Section 15.2</span></a> for a description of how we might replace the existing <code>fan</code> icons with a wind turbine icon from a different source.</p>
<p>Each plot created during the process of developing the original version of this visualisation was captured using {camcorder}, and is shown in the gif below. If you’d like to learn more about how {camcorder} can be used in the data visualisation process, see <a href="other-tricks.html#sec-camcorder" class="quarto-xref"><span>Section 15.1</span></a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/turbines.gif" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-img_anderson" class="csl-entry" role="listitem">
Anderson, Lance. 2017. <span>“School of Gray Fish.”</span> <a href="https://unsplash.com/photos/school-of-gray-fish-G2SDLsJp3rg">https://unsplash.com/photos/school-of-gray-fish-G2SDLsJp3rg</a>.
</div>
<div id="ref-Anscombe1973" class="csl-entry" role="listitem">
Anscombe, F. J. 1973. <span>“Graphs in Statistical Analysis.”</span> <em>The American Statistician</em> 27 (1): 17–21. <a href="https://doi.org/10.1080/00031305.1973.10478966">https://doi.org/10.1080/00031305.1973.10478966</a>.
</div>
<div id="ref-aphalo2024" class="csl-entry" role="listitem">
Aphalo, Pedro J. 2024. <em><span class="nocase">Learn R: As a Language</span></em>. Second Edition. CRC Press. <a href="https://www.learnr-book.info/">https://www.learnr-book.info/</a>.
</div>
<div id="ref-imager" class="csl-entry" role="listitem">
Barthelme, Simon. 2024. <em><span class="nocase">imager: Image Processing Library Based on ’CImg’</span></em>. <a href="https://CRAN.R-project.org/package=imager">https://CRAN.R-project.org/package=imager</a>.
</div>
<div id="ref-bridson2007" class="csl-entry" role="listitem">
Bridson, Robert. 2007. <span>“Fast Poisson Disk Sampling in Arbitrary Dimensions.”</span> In <em>ACM SIGGRAPH 2007 Sketches</em>. SIGGRAPH ’07. New York, NY, USA: Association for Computing Machinery. <a href="https://doi.org/10.1145/1278780.1278807">https://doi.org/10.1145/1278780.1278807</a>.
</div>
<div id="ref-Brown2009" class="csl-entry" role="listitem">
Brown, Mark J.F., and Paxton, Robert J. 2009. <span>“The Conservation of Bees: A Global Perspective.”</span> <em>Apidologie</em> 40 (3): 410–16. <a href="https://doi.org/10.1051/apido/2009019">https://doi.org/10.1051/apido/2009019</a>.
</div>
<div id="ref-geomtextpath" class="csl-entry" role="listitem">
Cameron, Allan, and Teun van den Brand. 2024. <em><span class="nocase">geomtextpath: Curved Text in ’ggplot2’</span></em>. <a href="https://CRAN.R-project.org/package=geomtextpath">https://CRAN.R-project.org/package=geomtextpath</a>.
</div>
<div id="ref-cartocolors" class="csl-entry" role="listitem">
CARTO. 2016. <em><span>’CARTOColors’ Palettes</span></em>. <a href="https://carto.com/carto-colors/">https://carto.com/carto-colors/</a>.
</div>
<div id="ref-extrafont" class="csl-entry" role="listitem">
Chang, Winston. 2023. <em><span class="nocase">extrafont</span>: Tools for Using Fonts</em>. <a href="https://CRAN.R-project.org/package=extrafont">https://CRAN.R-project.org/package=extrafont</a>.
</div>
<div id="ref-dumbbell" class="csl-entry" role="listitem">
Cheung, Foo. 2021. <em><span class="nocase">dumbbell</span>: Displaying Changes Between Two Points Using Dumbbell Plots</em>. <a href="https://CRAN.R-project.org/package=dumbbell">https://CRAN.R-project.org/package=dumbbell</a>.
</div>
<div id="ref-technology_data" class="csl-entry" role="listitem">
Comin, D. A., and B. Hobijn. 2009. <span>“The <span>CHAT</span> Dataset.”</span> Working Paper 15319. Working Paper Series. National Bureau of Economic Research. <a href="https://doi.org/10.3386/w15319">https://doi.org/10.3386/w15319</a>.
</div>
<div id="ref-pak" class="csl-entry" role="listitem">
Csárdi, Gábor, and Jim Hester. 2024. <em><span class="nocase">pak: Another Approach to Package Installation</span></em>. <a href="https://CRAN.R-project.org/package=pak">https://CRAN.R-project.org/package=pak</a>.
</div>
<div id="ref-remotes" class="csl-entry" role="listitem">
Csárdi, Gábor, Jim Hester, Hadley Wickham, Winston Chang, Martin Morgan, and Dan Tenenbaum. 2024. <em><span class="nocase">remotes: R Package Installation from Remote Repositories, Including ’GitHub’</span></em>. <a href="https://CRAN.R-project.org/package=remotes">https://CRAN.R-project.org/package=remotes</a>.
</div>
<div id="ref-seafood_data" class="csl-entry" role="listitem">
Database, RAM Legacy Stock Assessment. 2021. <span>“RAM Legacy Stock Assessment Database V4.495.”</span> Zenodo. <a href="https://doi.org/10.5281/zenodo.4824192">https://doi.org/10.5281/zenodo.4824192</a>.
</div>
<div id="ref-ggpattern" class="csl-entry" role="listitem">
FC, Mike, Trevor L. Davis, and ggplot2 authors. 2024. <em><span class="nocase">ggpattern: ’ggplot2’ Pattern Geoms</span></em>. <a href="https://CRAN.R-project.org/package=ggpattern">https://CRAN.R-project.org/package=ggpattern</a>.
</div>
<div id="ref-flaticon" class="csl-entry" role="listitem">
Flaticon.com. 2024. <span>“<span>Wind Power Flaticon</span>.”</span> <a href="https://www.flaticon.com/free-icon/wind-power_5670189" class="uri">https://www.flaticon.com/free-icon/wind-power_5670189</a>.
</div>
<div id="ref-fontawesome" class="csl-entry" role="listitem">
Font Awesome. 2024. <span>“<span>Font Awesome 6</span>.”</span> <a href="https://fontawesome.com/" class="uri">https://fontawesome.com/</a>.
</div>
<div id="ref-Hullman2021" class="csl-entry" role="listitem">
Franconeri, Steven L., Lace M. Padilla, Priti Shah, Jeffrey M. Zacks, and Jessica Hullman. 2021. <span>“The Science of Visual Data Communication: What Works.”</span> <em>Psychological Science in the Public Interest</em> 22 (3): 110–61. <a href="https://doi.org/10.1177/15291006211051956">https://doi.org/10.1177/15291006211051956</a>.
</div>
<div id="ref-viridis" class="csl-entry" role="listitem">
Garnier, Simon, Ross, Noam, Rudis, Robert, Camargo, et al. 2024. <em><span class="nocase">viridis(Lite)</span> - Colorblind-Friendly Color Maps for <span>R</span></em>. <a href="https://doi.org/10.5281/zenodo.4679423">https://doi.org/10.5281/zenodo.4679423</a>.
</div>
<div id="ref-GAcharts" class="csl-entry" role="listitem">
Government Analysis Function. 2021. <span>“Data Visualisation: Colours.”</span>
</div>
<div id="ref-geofacet" class="csl-entry" role="listitem">
Hafen, Ryan. 2023. <em><span class="nocase">geofacet</span>: <span class="nocase">’ggplot2’</span> Faceting Utilities for Geographical Data</em>. <a href="https://CRAN.R-project.org/package=geofacet">https://CRAN.R-project.org/package=geofacet</a>.
</div>
<div id="ref-harmon2024" class="csl-entry" role="listitem">
Harmon, Jon. 2024. <em><span class="nocase">Web APIs with R</span></em>. <span>CRC Press</span>. <a href="https://wapir.io/">https://wapir.io/</a>.
</div>
<div id="ref-lintr" class="csl-entry" role="listitem">
Hester, Jim, Florent Angly, Russ Hyde, Michael Chirico, Kun Ren, Alexander Rosenstock, and Indrajeet Patil. 2024. <em><span class="nocase">lintr</span>: A ’Linter’ for <span>R</span> Code</em>. <a href="https://CRAN.R-project.org/package=lintr">https://CRAN.R-project.org/package=lintr</a>.
</div>
<div id="ref-glue" class="csl-entry" role="listitem">
Hester, Jim, and Jennifer Bryan. 2024. <em><span class="nocase">glue</span>: Interpreted String Literals</em>. <a href="https://glue.tidyverse.org/">https://glue.tidyverse.org/</a>.
</div>
<div id="ref-camcorder" class="csl-entry" role="listitem">
Hughes, Ellis. 2022a. <em><span class="nocase">camcorder</span>: Record Your Plot History</em>. <a href="https://CRAN.R-project.org/package=camcorder">https://CRAN.R-project.org/package=camcorder</a>.
</div>
<div id="ref-tidytuesdayR" class="csl-entry" role="listitem">
———. 2022b. <em><span class="nocase">tidytuesdayR</span>: Access the Weekly ’TidyTuesday’ Project Dataset</em>. <a href="https://CRAN.R-project.org/package=tidytuesdayR">https://CRAN.R-project.org/package=tidytuesdayR</a>.
</div>
<div id="ref-paletteer" class="csl-entry" role="listitem">
Hvitfeldt, Emil. 2021. <em><span class="nocase">paletteer</span>: Comprehensive Collection of Color Palettes</em>. <a href="https://github.com/EmilHvitfeldt/paletteer">https://github.com/EmilHvitfeldt/paletteer</a>.
</div>
<div id="ref-zones_data" class="csl-entry" role="listitem">
Internet Assigned Numbers Authority. 2023. <span>“The <span class="nocase">tz</span> Database: Time Zone and Daylight Saving Time Data.”</span> <span>Internet Assigned Numbers Authority</span>. <a href="https://data.iana.org/time-zones/tz-link.html">https://data.iana.org/time-zones/tz-link.html</a>.
</div>
<div id="ref-img_jax" class="csl-entry" role="listitem">
Jax (@lysrix). 2017. <span>“Lemur.”</span> <a href="https://unsplash.com/photos/red-and-white-rodent-h5xrh3CNT-k">https://unsplash.com/photos/red-and-white-rodent-h5xrh3CNT-k</a>.
</div>
<div id="ref-kays2020" class="csl-entry" role="listitem">
Kays, R., R. R. Dunn, A. W. Parsons, B. Mcdonald, T. Perkins, S. A. Powers, L. Shell, et al. 2020. <span>“The Small Home Ranges and Large Local Ecological Impacts of Pet Cats.”</span> <em>Animal Conservation</em> 23 (5): 516–23. https://doi.org/<a href="https://doi.org/10.1111/acv.12563">https://doi.org/10.1111/acv.12563</a>.
</div>
<div id="ref-r4rest" class="csl-entry" role="listitem">
Keyes, David. 2024. <em><span class="nocase">R for the Rest of Us: A Statistics-Free Introduction</span></em>. No Starch Press. <a href="https://book.rfortherestofus.com/">https://book.rfortherestofus.com/</a>.
</div>
<div id="ref-museums_data" class="csl-entry" role="listitem">
Mapping Museums. 2021. <span>“Mapping Museums Data.”</span> <a href="https://www.mappingmuseums.org">www.mappingmuseums.org</a>.
</div>
<div id="ref-rnaturalearth" class="csl-entry" role="listitem">
Massicotte, Philippe, and Andy South. 2023. <em><span class="nocase">rnaturalearth</span>: World Map Data from Natural Earth</em>. <a href="https://docs.ropensci.org/rnaturalearth/">https://docs.ropensci.org/rnaturalearth/</a>.
</div>
<div id="ref-Matejka2017" class="csl-entry" role="listitem">
Matejka, Justin, and George Fitzmaurice. 2017. <span>“Same Stats, Different Graphs: Generating Datasets with Varied Appearance and Identical Statistics Through Simulated Annealing.”</span> In, 1290–94. <a href="https://doi.org/10.1145/3025453.3025912">https://doi.org/10.1145/3025453.3025912</a>.
</div>
<div id="ref-cats_data" class="csl-entry" role="listitem">
McDonald, J. L., and H. Cole. 2020. <span>“Data from: The Small Home Ranges and Large Local Ecological Impacts of Pet Cats [United Kingdom].”</span> Movebank data repository. <a href="https://doi.org/doi:10.5441/001/1.pf315732">https://doi.org/doi:10.5441/001/1.pf315732</a>.
</div>
<div id="ref-colorblindr" class="csl-entry" role="listitem">
McWhite, Claire D., and Claus O. Wilke. 2024. <em><span class="nocase">colorblindr: Simulate colorblindness in R figures</span></em>. <a href="https://github.com/clauswilke/colorblindr">https://github.com/clauswilke/colorblindr</a>.
</div>
<div id="ref-Apiculture" class="csl-entry" role="listitem">
Mid-Atlantic Apiculture Research and Extension Consortium. 2024. <span>“Seasonal Cycles of Activities in Colonies.”</span>
</div>
<div id="ref-poissoned" class="csl-entry" role="listitem">
mikefc. 2024. <em><span class="nocase">poissoned: Tileable Poisson Disc Sampling</span></em>. <a href="https://github.com/coolbutuseless/poissoned">https://github.com/coolbutuseless/poissoned</a>.
</div>
<div id="ref-MetBrewer" class="csl-entry" role="listitem">
Mills, Blake Robert. 2022. <em><span>MetBrewer</span>: Color Palettes Inspired by Works at the Metropolitan Museum of Art</em>. <a href="https://CRAN.R-project.org/package=MetBrewer">https://CRAN.R-project.org/package=MetBrewer</a>.
</div>
<div id="ref-elections_data" class="csl-entry" role="listitem">
MIT Election Data and Science Lab. 2017. <span>“<span>U.S. House 1976–2022</span>.”</span> Harvard Dataverse. <a href="https://doi.org/10.7910/DVN/IG0UN2">https://doi.org/10.7910/DVN/IG0UN2</a>.
</div>
<div id="ref-styler" class="csl-entry" role="listitem">
Müller, Kirill, and Lorenz Walthert. 2023. <em><span class="nocase">styler</span>: Non-Invasive Pretty Printing of <span>R</span> Code</em>. <a href="https://CRAN.R-project.org/package=styler">https://CRAN.R-project.org/package=styler</a>.
</div>
<div id="ref-tibble" class="csl-entry" role="listitem">
Müller, Kirill, and Hadley Wickham. 2023. <em><span class="nocase">tibble</span>: Simple Data Frames</em>. <a href="https://CRAN.R-project.org/package=tibble">https://CRAN.R-project.org/package=tibble</a>.
</div>
<div id="ref-turbines_data" class="csl-entry" role="listitem">
Natural Resources Canada. 2021. <span>“Canadian Wind Turbine Database.”</span> Natural Resources Canada (Government of Canada). <a href="https://open.canada.ca/data/en/dataset/79fdad93-9025-49ad-ba16-c26d718cc070">https://open.canada.ca/data/en/dataset/79fdad93-9025-49ad-ba16-c26d718cc070</a>.
</div>
<div id="ref-rcartocolor" class="csl-entry" role="listitem">
Nowosad, Jakub. 2018. <em><span>’CARTOColors’ Palettes</span></em>. <a href="https://jakubnowosad.com/rcartocolor/">https://jakubnowosad.com/rcartocolor/</a>.
</div>
<div id="ref-magick" class="csl-entry" role="listitem">
Ooms, Jeroen. 2024. <em><span class="nocase">magick: Advanced Graphics and Image-Processing in R</span></em>. <a href="https://CRAN.R-project.org/package=magick">https://CRAN.R-project.org/package=magick</a>.
</div>
<div id="ref-doctors_data" class="csl-entry" role="listitem">
Our World in Data. 2019. <span>“Medical Doctors Per 1,000 People.”</span> <a href="https://ourworldindata.org/grapher/physicians-per-1000-people">https://ourworldindata.org/grapher/physicians-per-1000-people</a>.
</div>
<div id="ref-sf" class="csl-entry" role="listitem">
Pebesma, Edzer. 2018. <span>“<span class="nocase">Simple Features for R: Standardized Support for Spatial Vector Data</span>.”</span> <em><span>The R Journal</span></em> 10 (1): 439–46. <a href="https://doi.org/10.32614/RJ-2018-009">https://doi.org/10.32614/RJ-2018-009</a>.
</div>
<div id="ref-ggforce" class="csl-entry" role="listitem">
Pedersen, Thomas Lin. 2022. <em><span class="nocase">ggforce</span>: Accelerating <span class="nocase">’ggplot2’</span></em>. <a href="https://CRAN.R-project.org/package=ggforce">https://CRAN.R-project.org/package=ggforce</a>.
</div>
<div id="ref-patchwork" class="csl-entry" role="listitem">
———. 2024. <em><span class="nocase">patchwork</span>: The Composer of Plots</em>. <a href="https://CRAN.R-project.org/package=patchwork">https://CRAN.R-project.org/package=patchwork</a>.
</div>
<div id="ref-marquee" class="csl-entry" role="listitem">
Pedersen, Thomas Lin, and Martin Mitáš. 2024. <em><span class="nocase">marquee: Markdown Parser and Renderer for R Graphics</span></em>. <a href="https://CRAN.R-project.org/package=marquee">https://CRAN.R-project.org/package=marquee</a>.
</div>
<div id="ref-systemfonts" class="csl-entry" role="listitem">
Pedersen, Thomas Lin, Jeroen Ooms, and Devon Govett. 2024. <em><span class="nocase">systemfonts: System Native Font Finding</span></em>. <a href="https://CRAN.R-project.org/package=systemfonts">https://CRAN.R-project.org/package=systemfonts</a>.
</div>
<div id="ref-ragg" class="csl-entry" role="listitem">
Pedersen, Thomas Lin, and Maxim Shemanarev. 2023. <em><span class="nocase">ragg</span>: Graphic Devices Based on <span>AGG</span></em>. <a href="https://CRAN.R-project.org/package=ragg">https://CRAN.R-project.org/package=ragg</a>.
</div>
<div id="ref-pldb_data" class="csl-entry" role="listitem">
PLDB contributors. 2022. <span>“<span>PLDB</span>: A Programming Language Database.”</span> <em><span>PLDB</span></em>.
</div>
<div id="ref-sysfonts" class="csl-entry" role="listitem">
Qiu, Yixuan, and authors/contributors of the included fonts. See file AUTHORS for details. 2022. <em><span class="nocase">sysfonts</span>: Loading Fonts into <span>R</span></em>. <a href="https://CRAN.R-project.org/package=sysfonts">https://CRAN.R-project.org/package=sysfonts</a>.
</div>
<div id="ref-showtext" class="csl-entry" role="listitem">
Qiu, Yixuan, and authors/contributors of the included software. See file AUTHORS for details. 2023. <em><span class="nocase">showtext</span>: Using Fonts More Easily in <span>R</span> Graphs</em>. <a href="https://CRAN.R-project.org/package=showtext">https://CRAN.R-project.org/package=showtext</a>.
</div>
<div id="ref-rproj" class="csl-entry" role="listitem">
R Core Team. 2024. <em><span>R</span>: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/">https://www.R-project.org/</a>.
</div>
<div id="ref-tidytuesday" class="csl-entry" role="listitem">
R4DS Online Learning Community. 2023. <span>“Tidy Tuesday: A Weekly Social Data Project.”</span> <a href="https://github.com/rfordatascience/tidytuesday">https://github.com/rfordatascience/tidytuesday</a>.
</div>
<div id="ref-social_icons" class="csl-entry" role="listitem">
Rennie, Nicola. 2023a. <span>“Adding Social Media Icons to Charts with <span class="nocase">ggplot2</span>.”</span> <a href="https://nrennie.rbind.io/blog/adding-social-media-icons-ggplot2/">https://nrennie.rbind.io/blog/adding-social-media-icons-ggplot2/</a>.
</div>
<div id="ref-template_files" class="csl-entry" role="listitem">
———. 2023b. <span>“Creating Template Files with <span>R</span>.”</span> <a href="https://nrennie.rbind.io/blog/script-templates-r/">https://nrennie.rbind.io/blog/script-templates-r/</a>.
</div>
<div id="ref-streamline" class="csl-entry" role="listitem">
———. 2023c. <span>“Four Ways to Streamline Your <span>R</span> Workflows.”</span> <a href="https://nrennie.rbind.io/blog/four-ways-streamline-r-workflows/">https://nrennie.rbind.io/blog/four-ways-streamline-r-workflows/</a>.
</div>
<div id="ref-ggtextcircle" class="csl-entry" role="listitem">
———. 2024a. <em><span class="nocase">ggtextcircle: Circular Text in ’ggplot2’</span></em>. <a href="https://github.com/nrennie/ggtextcircle">https://github.com/nrennie/ggtextcircle</a>.
</div>
<div id="ref-pkgs_data" class="csl-entry" role="listitem">
———. 2024b. <span>“<span class="nocase">tidytuesday</span>.”</span> <em>GitHub Repository</em>. GitHub. <a href="https://github.com/nrennie/tidytuesday">https://github.com/nrennie/tidytuesday</a>.
</div>
<div id="ref-signif2024a" class="csl-entry" role="listitem">
Rennie, Nicola, and Andreas Krause. 2024. <span>“<span class="nocase">Presenting data the Significance way - Part 1</span>.”</span> <em>Significance</em> 21 (3): 36–39. <a href="https://doi.org/10.1093/jrssig/qmae045">https://doi.org/10.1093/jrssig/qmae045</a>.
</div>
<div id="ref-hex_forcats" class="csl-entry" role="listitem">
RStudio. 2018a. <span>“<span class="nocase">forcats</span> Hex Sticker.”</span> <a href="https://github.com/rstudio/hex-stickers/blob/main/PNG/forcats.png">https://github.com/rstudio/hex-stickers/blob/main/PNG/forcats.png</a>.
</div>
<div id="ref-hex_ggplot2" class="csl-entry" role="listitem">
———. 2018b. <span>“<span class="nocase">ggplot2</span> Hex Sticker.”</span> <a href="https://github.com/rstudio/hex-stickers/blob/main/PNG/ggplot2.png">https://github.com/rstudio/hex-stickers/blob/main/PNG/ggplot2.png</a>.
</div>
<div id="ref-hex_purrr" class="csl-entry" role="listitem">
———. 2018c. <span>“<span class="nocase">purrr</span> Hex Sticker.”</span> <a href="https://github.com/rstudio/hex-stickers/blob/main/PNG/purrr.png">https://github.com/rstudio/hex-stickers/blob/main/PNG/purrr.png</a>.
</div>
<div id="ref-hex_readr" class="csl-entry" role="listitem">
———. 2018d. <span>“<span class="nocase">readr</span> Hex Sticker.”</span> <a href="https://github.com/rstudio/hex-stickers/blob/main/PNG/readr.png">https://github.com/rstudio/hex-stickers/blob/main/PNG/readr.png</a>.
</div>
<div id="ref-hex_tibble" class="csl-entry" role="listitem">
———. 2018e. <span>“<span class="nocase">tibble</span> Hex Sticker.”</span> <a href="https://github.com/rstudio/hex-stickers/blob/main/PNG/tibble.png">https://github.com/rstudio/hex-stickers/blob/main/PNG/tibble.png</a>.
</div>
<div id="ref-hex_dplyr" class="csl-entry" role="listitem">
———. 2020a. <span>“<span class="nocase">dplyr</span> Hex Sticker.”</span> <a href="https://github.com/rstudio/hex-stickers/blob/main/PNG/dplyr.png">https://github.com/rstudio/hex-stickers/blob/main/PNG/dplyr.png</a>.
</div>
<div id="ref-hex_stringr" class="csl-entry" role="listitem">
———. 2020b. <span>“<span class="nocase">stringr</span> Hex Sticker.”</span> <a href="https://github.com/rstudio/hex-stickers/blob/main/PNG/stringr.png">https://github.com/rstudio/hex-stickers/blob/main/PNG/stringr.png</a>.
</div>
<div id="ref-hex_tidyr" class="csl-entry" role="listitem">
———. 2020c. <span>“<span class="nocase">tidyr</span> Hex Sticker.”</span> <a href="https://github.com/rstudio/hex-stickers/blob/main/PNG/tidyr.png">https://github.com/rstudio/hex-stickers/blob/main/PNG/tidyr.png</a>.
</div>
<div id="ref-ggalt" class="csl-entry" role="listitem">
Rudis, Bob, Ben Bolker, and Jan Schulz. 2017. <em><span class="nocase">ggalt</span>: Extra Coordinate Systems, ’Geoms’, Statistical Transformations, Scales and Fonts for ’Ggplot2’</em>. <a href="https://CRAN.R-project.org/package=ggalt">https://CRAN.R-project.org/package=ggalt</a>.
</div>
<div id="ref-waffle" class="csl-entry" role="listitem">
Rudis, Bob, and Dave Gandy. 2023. <em><span class="nocase">waffle</span>: Create Waffle Chart Visualizations</em>. <a href="https://CRAN.R-project.org/package=waffle">https://CRAN.R-project.org/package=waffle</a>.
</div>
<div id="ref-openxlsx" class="csl-entry" role="listitem">
Schauberger, Philipp, and Alexander Walker. 2023. <em><span class="nocase">openxlsx: Read, Write and Edit xlsx Files</span></em>. <a href="https://CRAN.R-project.org/package=openxlsx">https://CRAN.R-project.org/package=openxlsx</a>.
</div>
<div id="ref-Schloss" class="csl-entry" role="listitem">
Schloss, Karen B., Connor C. Gramazio, Allison T. Silverman, Madeline L. Parker, and Audrey S. Wang. 2019. <span>“Mapping Color to Meaning in Colormap Data Visualizations.”</span> <em>IEEE Transactions on Visualization and Computer Graphics</em> 25 (1): 810–19. <a href="https://doi.org/10.1109/TVCG.2018.2865147">https://doi.org/10.1109/TVCG.2018.2865147</a>.
</div>
<div id="ref-funspotr" class="csl-entry" role="listitem">
Shalloway, Bryan. 2023. <em><span class="nocase">funspotr: Spot R Functions &amp; Packages</span></em>. <a href="https://CRAN.R-project.org/package=funspotr">https://CRAN.R-project.org/package=funspotr</a>.
</div>
<div id="ref-visdat" class="csl-entry" role="listitem">
Tierney, Nicholas. 2017. <span>“<span class="nocase">visdat: Visualising Whole Data Frames</span>.”</span> <em>JOSS</em> 2 (16): 355. <a href="https://doi.org/10.21105/joss.00355">https://doi.org/10.21105/joss.00355</a>.
</div>
<div id="ref-naniar" class="csl-entry" role="listitem">
Tierney, Nicholas, and Dianne Cook. 2023. <span>“Expanding Tidy Data Principles to Facilitate Missing Data Exploration, Visualization and Assessment of Imputations.”</span> <em>Journal of Statistical Software</em> 105 (7): 1–31. <a href="https://doi.org/10.18637/jss.v105.i07">https://doi.org/10.18637/jss.v105.i07</a>.
</div>
<div id="ref-Tol2021" class="csl-entry" role="listitem">
Tol, Paul. 2021. <span>“<span class="nocase">Paul Tol’s Notes: Colour schemes and templates</span>.”</span> <a href="https://personal.sron.nl/~pault/" class="uri">https://personal.sron.nl/~pault/</a>.
</div>
<div id="ref-UScensus" class="csl-entry" role="listitem">
United States Census Bureau. 2021. <span>“State Area Measurements and Internal Point Coordinates.”</span>
</div>
<div id="ref-bees_data" class="csl-entry" role="listitem">
United States Department of Agriculture: Economics, Statistics and Market Information System. 2022. <span>“Honey Bee Colonies.”</span> <span>USDA Economics, Statistics and Market Information System</span>. <a href="https://usda.library.cornell.edu/concern/publications/rn301137d">https://usda.library.cornell.edu/concern/publications/rn301137d</a>.
</div>
<div id="ref-crsuggest" class="csl-entry" role="listitem">
Walker, Kyle. 2022. <em>Crsuggest: Obtain Suggested Coordinate Reference System Information for Spatial Data</em>. <a href="https://CRAN.R-project.org/package=crsuggest">https://CRAN.R-project.org/package=crsuggest</a>.
</div>
<div id="ref-Wanzer2021" class="csl-entry" role="listitem">
Wanzer, Dana Linnell, Tarek Azzam, Natalie D. Jones, and Darrel Skousen. 2021. <span>“The Role of Titles in Enhancing Data Visualization.”</span> <em>Evaluation and Program Planning</em> 84: 101896. https://doi.org/<a href="https://doi.org/10.1016/j.evalprogplan.2020.101896">https://doi.org/10.1016/j.evalprogplan.2020.101896</a>.
</div>
<div id="ref-ggplot2" class="csl-entry" role="listitem">
Wickham, Hadley. 2016. <em><span class="nocase">ggplot2</span>: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-stringr" class="csl-entry" role="listitem">
———. 2023. <em><span class="nocase">stringr: Simple, Consistent Wrappers for Common String Operations</span></em>. <a href="https://CRAN.R-project.org/package=stringr">https://CRAN.R-project.org/package=stringr</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-readxl" class="csl-entry" role="listitem">
Wickham, Hadley, and Jennifer Bryan. 2023. <em><span class="nocase">readxl: Read Excel Files</span></em>. <a href="https://CRAN.R-project.org/package=readxl">https://CRAN.R-project.org/package=readxl</a>.
</div>
<div id="ref-r4ds" class="csl-entry" role="listitem">
Wickham, Hadley, Mine Çetinkaya-Rundel, and Garrett Grolemund. 2023. <em><span>R</span> for Data Science</em>. Second Edition. O-Reilly. <a href="https://r4ds.hadley.nz">https://r4ds.hadley.nz</a>.
</div>
<div id="ref-dplyr" class="csl-entry" role="listitem">
Wickham, Hadley, Romain François, Lionel Henry, Kirill Müller, and Davis Vaughan. 2023. <em><span class="nocase">dplyr</span>: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div id="ref-purrr" class="csl-entry" role="listitem">
Wickham, Hadley, and Lionel Henry. 2023. <em><span class="nocase">purrr</span>: Functional Programming Tools</em>. <a href="https://CRAN.R-project.org/package=purrr">https://CRAN.R-project.org/package=purrr</a>.
</div>
<div id="ref-readr" class="csl-entry" role="listitem">
Wickham, Hadley, Jim Hester, and Jennifer Bryan. 2024. <em><span class="nocase">readr</span>: Read Rectangular Text Data</em>. <a href="https://CRAN.R-project.org/package=readr">https://CRAN.R-project.org/package=readr</a>.
</div>
<div id="ref-scales" class="csl-entry" role="listitem">
Wickham, Hadley, Thomas Lin Pedersen, and Dana Seidel. 2023. <em><span class="nocase">scales</span>: Scale Functions for Visualization</em>. <a href="https://CRAN.R-project.org/package=scales">https://CRAN.R-project.org/package=scales</a>.
</div>
<div id="ref-tidyr" class="csl-entry" role="listitem">
Wickham, Hadley, Davis Vaughan, and Maximilian Girlich. 2024. <em><span class="nocase">tidyr</span>: Tidy Messy Data</em>. <a href="https://CRAN.R-project.org/package=tidyr">https://CRAN.R-project.org/package=tidyr</a>.
</div>
<div id="ref-ggtextures" class="csl-entry" role="listitem">
Wilke, Claus. 2022. <em><span class="nocase">ggtextures: Drawing Textured Rectangles and Bars with grid and ggplot2</span></em>. <a href="https://github.com/clauswilke/ggtextures">https://github.com/clauswilke/ggtextures</a>.
</div>
<div id="ref-cowplot" class="csl-entry" role="listitem">
Wilke, Claus O. 2024. <em><span class="nocase">cowplot</span>: Streamlined Plot Theme and Plot Annotations for <span class="nocase">’ggplot2’</span></em>. <a href="https://wilkelab.org/cowplot/">https://wilkelab.org/cowplot/</a>.
</div>
<div id="ref-ggtext" class="csl-entry" role="listitem">
Wilke, Claus O., and Brenton M. Wiernik. 2022. <em><span class="nocase">ggtext</span>: Improved Text Rendering Support for <span class="nocase">’ggplot2’</span></em>. <a href="https://CRAN.R-project.org/package=ggtext">https://CRAN.R-project.org/package=ggtext</a>.
</div>
<div id="ref-nobel_data" class="csl-entry" role="listitem">
www.nobelprize.org. 2024. <span>“<span>Nobel Prize API Version 2.1</span>.”</span> <a href="https://api.nobelprize.org/2.1/laureates">https://api.nobelprize.org/2.1/laureates</a>.
</div>
<div id="ref-owidR" class="csl-entry" role="listitem">
York, Piers. 2023. <em><span class="nocase">owidR</span>: Import Data from Our World in Data</em>. <a href="<https://github.com/piersyork/owidR>">&lt;https://github.com/piersyork/owidR&gt;</a>.
</div>
<div id="ref-ggimage" class="csl-entry" role="listitem">
Yu, Guangchuang. 2023. <em><span class="nocase">ggimage: Use Image in ’ggplot2’</span></em>. <a href="https://CRAN.R-project.org/package=ggimage">https://CRAN.R-project.org/package=ggimage</a>.
</div>
<div id="ref-gghighlight" class="csl-entry" role="listitem">
Yutani, Hiroaki. 2023. <em><span class="nocase">gghighlight</span>: Highlight Lines and Points in <span class="nocase">’ggplot2’</span></em>. <a href="https://CRAN.R-project.org/package=gghighlight">https://CRAN.R-project.org/package=gghighlight</a>.
</div>
<div id="ref-lemurs_data" class="csl-entry" role="listitem">
Zehr, Sarah M., Richard G. Roach, David Haring, Julie Taylor, Freda H. Cameron, and Anne D. Yoder. 2014. <span>“<span class="nocase">Life history profiles for 27 strepsirrhine primate taxa generated using captive data from the Duke Lemur Center</span>.”</span> <em>Scientific Data</em> 1 (1). <a href="https://doi.org/10.1038/sdata.2014.19">https://doi.org/10.1038/sdata.2014.19</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./text.html" class="pagination-link" aria-label="Making use of icons, fonts, and text">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Making use of icons, fonts, and text</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./cats.html" class="pagination-link" aria-label="Cats: data-driven annotations with {ggtext}">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Cats: data-driven annotations with {ggtext}</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<script src="site_libs/quarto-contrib/line-highlight-1.0.0/line-highlight.js" defer="true"></script>
</body></html>