---
filters:
  - line-highlight
execute: 
  freeze: auto
---

# Lemurs: combining plots with {patchwork} {#sec-lemurs}

## Data

```{r}
#| label: load-lemurs-data-show
#| eval: false
#| echo: true
tuesdata <- tidytuesdayR::tt_load("2021-08-24")
lemurs <- tuesdata$lemurs
```

```{r}
#| label: load-lemurs-data-hide
#| output: false
#| echo: false
#| eval: true
lemurs <- readr::read_csv("data/lemur_data.csv")
```

## Exploratory work

### Data exploration

### Exploratory sketches

## Preparing a plot

### Data wrangling

```{r}
#| label: lemurs-wrangling-1
cb_lemurs <- lemurs |>
  dplyr::filter(taxon == "ECOL")
```


```{r}
#| label: lemurs-wrangling-2
oldest_cb_lemurs <- cb_lemurs |> 
  dplyr::select(name, sex, dob, dod, age_max_live_or_dead_y) |>
  dplyr::distinct() |>
  dplyr::slice_max(age_max_live_or_dead_y, n = 10)
```


```{r}
#| label: lemurs-wrangling-3
plot_data <- oldest_cb_lemurs |>
  dplyr::mutate(
    name = stringr::str_to_title(name),
    name = factor(name, levels = name),
    dod2 = tidyr::replace_na(dod, lubridate::ymd("2021-08-24")),
    mid_date = dob + floor(0.5 * (dod2 - dob)),
    age_text = paste(round(age_max_live_or_dead_y, 1), "years")
  )
```

maybe pivot longer

### The first plot

#### Dumbbell plot


```{r}
#| label: fig-lemurs-dumbbel
#| fig-cap: ""
#| fig-width: 5
#| fig-asp: 4
library(ggplot2)
p1 <- ggplot(data = plot_data) +
  geom_point(
    mapping = aes(
      x = dob,
      y = name,
      colour = sex
    )
  ) +
  geom_point(
    mapping = aes(
      x = dod,
      y = name, colour = sex
    )
  ) +
  geom_segment(
    mapping = aes(
      x = dob, xend = dod2,
      y = name, yend = name,
      colour = sex)
  ) +
  geom_text(
    mapping = aes(
      x = mid_date, y = name,
      label = age_text, 
      colour = sex
    ),
    vjust = -0.5
  )



# scale_colour_manual("", values = c("F" = "#b13173", "M" = "#21ADA8"), labels = c("Female", "Male")) +
#   labs(x = "", y = "")
# 
# 
# theme(
#   plot.background = element_rect(fill = "#F5F5DC", colour = "#F5F5DC"),
#   panel.background = element_rect(fill = "#F5F5DC", colour = "#F5F5DC"),
#   legend.background = element_rect(fill = "#F5F5DC", colour = "#F5F5DC"),
#   legend.position = "none",
#   legend.key = element_rect(fill = "#F5F5DC"),
#   legend.text = element_text(colour = "#4e2e12", size = 12, hjust = 0.5, family = "Gill Sans MT Condensed"),
#   axis.text = element_text(colour = "#4e2e12", size = 12, hjust = 0.5, family = "Gill Sans MT Condensed"),
#   axis.title = element_text(colour = "#4e2e12", size = 12, hjust = 0.5, family = "Gill Sans MT Condensed"),
#   plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"), # top, right, bottom, left
#   panel.grid.major.y = element_line(colour = alpha("#4e2e12", 0.3)),
#   panel.grid.major.x = element_blank(),
#   panel.grid.minor = element_blank()
# )
p1
```

will get missing value warning and this is fine

#### Scatter plot

```{r}
#| label: fig-lemurs-scatter
#| fig-cap: ""
#| fig-width: 5
#| fig-asp: 4
p2 <- ggplot() +
  geom_point(data = cb_lemurs,
             mapping = aes(x = age_at_wt_mo, y = weight_g, colour = sex),
             size = 0.5) +
  labs(x = "Age (months)", y = "Weight (g)")
  # theme(
  #   plot.background = element_rect(fill = "#F5F5DC", colour = "#F5F5DC"),
  #   panel.background = element_rect(fill = "#F5F5DC", colour = "#F5F5DC"),
  #   legend.background = element_rect(fill = "#F5F5DC", colour = "#F5F5DC"),
  #   legend.position = "bottom",
  #   legend.key = element_rect(fill = "#F5F5DC"),
  #   legend.text = element_text(colour = "#4e2e12", size = 12, hjust = 0.5, family = "Gill Sans MT Condensed"),
  #   axis.text = element_text(colour = "#4e2e12", size = 12, hjust = 0.5, family = "Gill Sans MT Condensed"),
  #   axis.title = element_text(colour = "#4e2e12", size = 12, hjust = 0.5, family = "Gill Sans MT Condensed"),
  #   plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"), # top, right, bottom, left
  #   panel.grid.major = element_line(colour = alpha("#4e2e12", 0.3)),
  #   panel.grid.minor = element_blank()
  #)
p2
```


```{r}
#| label: fig-lemurs-blank
p3 <- ggplot() +
  theme(
    plot.background = element_rect(fill = "#F5F5DC", colour = "#F5F5DC"),
    panel.background = element_rect(fill = "#F5F5DC", colour = "#F5F5DC"),
    legend.background = element_rect(fill = "#F5F5DC", colour = "#F5F5DC"),
    legend.position = "bottom",
    legend.key = element_rect(fill = "#F5F5DC"),
    plot.margin = unit(c(0.5, 0.5, 0.5, 0.5), "cm"), # top, right, bottom, left
    panel.grid.major = element_line(colour = alpha("#b13173", 0.3)),
    panel.grid.minor = element_blank()
  )
```

## Advanced styling

### Colours

```{r}
#| label: lemurs-colors
bg_col <- "#F5F5DC"
text_col <- "#4e2e12"
f_col <- "#b13173"
m_col <- "#21ADA8"
```


### Text and fonts

### Adjusting themes

```{r}
#| label: lemurs-style-theme
lemur_theme <- 
  theme_void(base_size = 7) +
  theme(
    plot.background = element_rect(
      fill = bg_col, colour = bg_col),
    panel.background = element_rect(
      fill = bg_col, colour = bg_col),
    legend.background = element_rect(
      fill = bg_col, colour = bg_col),
    legend.position = "bottom",
    legend.key = element_rect(fill = bg_col),
    plot.margin = margin(5, 5, 5, 5),
    panel.grid.major = element_line(
      colour = alpha(f_col, 0.3)),
    panel.grid.minor = element_blank()
  )
```

```{r}
#| label: fig-lemurs-style-scatter
#| fig-cap: ""
p1 + 
  scale_color_manual(
  values = c(m_col, f_col),
  breaks = c("M", "F"),
  labels = c("Male", "Female")
) + 
  lemur_theme
```



## Combining plots with {patchwork}

```{r}
#| label: fig-lemurs-join
library(patchwork)
p0 <- p2 + p3 + plot_layout(nrow = 2, ncol = 1)
p <- p1 + p0 +
  plot_annotation(
    title = "\nCollared Brown Lemur",
    caption = "N. Rennie | Data:  Duke Lemur Center | Image:  Duke Lemur Center",
    subtitle = "\nAt Duke Lemur Center, collared brown lemurs live to an average of 23.6 years. The oldest\ncollared brown lemur at Duke Lemur Center was Yvette who was born in 1959 and lived\nto the age of 32.6 years. \n\nCollared brown lemurs mature at about 3 years old. Once fully-grown, females tend to\nweigh more than males."
  ) 
# add theme back in
p
```

## Image

```{r}
# add lemur image
lemur <- "images/lemur-nobg.png"
q <- cowplot::ggdraw() +
  cowplot::draw_plot(p) +
  cowplot::draw_image(lemur, x = 0.78, y = 0.27, hjust = 0.5, vjust = 1, halign = 1, valign = 1, width = 0.6)
q
```


## Reflection
