[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "The #TidyTuesday Cookbook",
    "section": "",
    "text": "Preface\nWelcome to the online version of The #TidyTuesday Cookbook by Nicola Rennie.\nThis book is currently a work-in-progress.",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "index.html#about-the-author",
    "href": "index.html#about-the-author",
    "title": "The #TidyTuesday Cookbook",
    "section": "About the author",
    "text": "About the author\nNicola Rennie is a Lecturer in Health Data Science within the Centre for Health Informatics, Computing, and Statistics at Lancaster University. She holds a PhD in Statistics and Operational Research, focusing on analysing and visualising transport demand. Her current research is focused on applications of statistics and machine learning to health-related data, communicating statistics, and the effective teaching of data science. She has experience of teaching at both undergraduate and postgraduate level, in courses covering fundamentals of data science, population health, and statistical programming. Nicola has also previously worked in data science consultancy, and delivered training courses covering topics including advanced data visualisation with R, statistical modelling, and reproducible reporting. She is the author and maintainer of several R packages, including multiple {ggplot2} extension packages. Nicola is a regular speaker at R and data science meetups, and is the current chapter organiser of R-Ladies Lancaster. She is co-author of the Royal Statistical Society’s Best Practices for Data Visualisation Guide, and an active member of the Royal Statistical Society. Several of her data visualisations have been long-listed at the Information is Beautiful Awards.",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "introduction.html",
    "href": "introduction.html",
    "title": "1  Introduction",
    "section": "",
    "text": "1.1 Why visualize data?\nData visualization can be a very effective and efficient means of communicating information. Visualizing your data typically serves one of two purposes: (i) as part of exploratory analysis to help uncover discrepancies in data and identify interesting relationships to measure; or (ii) to communicate key insights and messages to a broader audience. The case-study nature of this book means that we’ll talk about both of these aspects, though we ’ll focus mostly on the second.\nChoosing an appropriate type of visualization and making careful choice about design can clarify the message you are trying to convey to a reader. That does not necessarily mean that every chart must follow a set of rules and stick to a rigid format. Instead, data visualization is a blend of science and creativity - many of the key landmark data visualizations held up as excellent examples don’t fit into the standard categories of bar charts, scatter plots, or line graphs.\nThat being said, the visualizations in this book are not necessarily always the most effective choice of visualization for the data and relationship shown. Rather, this book aims to show you examples of the end-to-end process of creating data visualizations, with a focus on the technical details of building them in R. You’ll see some hacky solutions and unusual ideas that you can use to transform your data visualizations.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "introduction.html#what-is-tidytuesday",
    "href": "introduction.html#what-is-tidytuesday",
    "title": "1  Introduction",
    "section": "1.2 What is #TidyTuesday?",
    "text": "1.2 What is #TidyTuesday?\n#TidyTuesday (Community 2023) is a weekly social data project which aims to make learning to work with data easier, by providing real-world datasets. Participants are encouraged to explore the data shared via GitHub each week, create an output such as a data visualization, and share their output alongside their code, with the community.\nAfter three years of weekly contributions, I’ve worked with around 150 datasets and created over 150 data visualizations. This book will present a subset of these visualizations, and describe the process used to create them. Each chapter will cover a different data visualization, showing: the data exploration process; the choice of data visualization type; the initial design ideas with hand-drawn sketches; the first build of a plot; and the iterative process of styling plots.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "introduction.html#background-knowledge",
    "href": "introduction.html#background-knowledge",
    "title": "1  Introduction",
    "section": "1.3 Background knowledge",
    "text": "1.3 Background knowledge\nThis book is primarily aimed at those who wish to develop their data visualization skills in R. Readers of this book may find a basic knowledge of R, more specifically of the {tidyverse} ecosystem, useful though all code used in examples is fully explained. Readers do not need to be experienced in {ggplot2}, though this book will also be of interest to those who are. Readers of this book will be of interest to those who are already familiar with R (including {ggplot2}), and wish to develop their skills in designing data visualizations further. It will also be of interest to those who already design data visualizations using other tools, and want to learn how to do the equivalent in R.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "introduction.html#a-note-about-r-code",
    "href": "introduction.html#a-note-about-r-code",
    "title": "1  Introduction",
    "section": "1.4 A note about R code",
    "text": "1.4 A note about R code\nAll code in this was created using R version 4.3.0, and a complete list of package versions can be found in the Appendix.\n\n1.4.1 Base R pipe vs {magrittr} pipe\nIn R, the pipe operator takes the thing on its left and passes it along to the function on its right (Wickham, Çetinkaya-Rundel, and Grolemund 2023). You can find a full description of the pipe operator in R for Data Science. The pipe (%&gt;%) was first introduced to R via the {magrittr} package. Since version 4.1.0 of R, a version of the pipe (|&gt;) has existed in base R. The base R version of the pipe is used throughout the book. Although there are some difference between the two version of the pipe, in this book, they can be used interchangeably.\n\n\n1.4.2 Namespacing\nNamespacing (the pre-fixing of functions with the package name and ::) is used for all packages except {ggplot2} and base R packages. Namespacing is useful for two reasons (i) from a learning perspective, it makes it easier to recognise where functions come from and how they connect together, and (ii) from a programming perspective, it reduces conflicts and errors - something we all want less of!\n\n\n1.4.3 Changes to from earlier versions\nYou may notice that some of the final images differ slightly from those initially created and published on social media. You might also find some small differences in the code used to produce them if you compare the contents of this book to original scripts in the GitHub repository. These differences are likely due to one of four reasons:\n\npackages have since been updated and code has been changed to use newer syntax;\nsome aspects have been omitted from a visualization to avoid explaining everything in Chapter 1 - but those aspects are all covered and linked to in later chapters;\nafter many years of practice, there may be more efficient ways of re-writing code from some of the earlier plots. Any changes are clearly labelled and discussed;\nsome images may be different due to copyright reasons.\n\n\n\n\n\nCommunity, R4DS Online Learning. 2023. “Tidy Tuesday: A Weekly Social Data Project.” https://github.com/rfordatascience/tidytuesday.\n\n\nWickham, Hadley, Mine Çetinkaya-Rundel, and Garrett Grolemund. 2023. R for Data Science. O-Reilly. https://r4ds.hadley.nz.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "uk-museums.html",
    "href": "uk-museums.html",
    "title": "2  UK Museums: highlighting line charts with {gghighlight}",
    "section": "",
    "text": "2.1 Data\n(Museums 2021)\nmuseums &lt;- readr::read_csv(\"data/museums.csv\")",
    "crumbs": [
      "Common charts don't need to be boring!",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>UK Museums: highlighting line charts with {gghighlight}</span>"
    ]
  },
  {
    "objectID": "uk-museums.html#initial-exploration",
    "href": "uk-museums.html#initial-exploration",
    "title": "2  UK Museums: highlighting line charts with {gghighlight}",
    "section": "\n2.2 Initial exploration",
    "text": "2.2 Initial exploration",
    "crumbs": [
      "Common charts don't need to be boring!",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>UK Museums: highlighting line charts with {gghighlight}</span>"
    ]
  },
  {
    "objectID": "uk-museums.html#basic-plot",
    "href": "uk-museums.html#basic-plot",
    "title": "2  UK Museums: highlighting line charts with {gghighlight}",
    "section": "\n2.3 Basic plot",
    "text": "2.3 Basic plot",
    "crumbs": [
      "Common charts don't need to be boring!",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>UK Museums: highlighting line charts with {gghighlight}</span>"
    ]
  },
  {
    "objectID": "uk-museums.html#adding-styling",
    "href": "uk-museums.html#adding-styling",
    "title": "2  UK Museums: highlighting line charts with {gghighlight}",
    "section": "\n2.4 Adding styling",
    "text": "2.4 Adding styling",
    "crumbs": [
      "Common charts don't need to be boring!",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>UK Museums: highlighting line charts with {gghighlight}</span>"
    ]
  },
  {
    "objectID": "uk-museums.html#the-making-of",
    "href": "uk-museums.html#the-making-of",
    "title": "2  UK Museums: highlighting line charts with {gghighlight}",
    "section": "\n2.5 The making of…",
    "text": "2.5 The making of…\nsee the making of . If you’d like to read more about {camcorder} - see chapter … .\n\n\n\n\n\nMuseums, Mapping. 2021. “Mapping Museums Data.” www.mappingmuseums.org.",
    "crumbs": [
      "Common charts don't need to be boring!",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>UK Museums: highlighting line charts with {gghighlight}</span>"
    ]
  },
  {
    "objectID": "doctors-ageing-population.html",
    "href": "doctors-ageing-population.html",
    "title": "3  Doctors in an ageing population: making maps with {ggplot2}",
    "section": "",
    "text": "3.1 Data\nBring your own data",
    "crumbs": [
      "Visualising spatial data",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Doctors in an ageing population: making maps with {ggplot2}</span>"
    ]
  },
  {
    "objectID": "doctors-ageing-population.html#data",
    "href": "doctors-ageing-population.html#data",
    "title": "3  Doctors in an ageing population: making maps with {ggplot2}",
    "section": "",
    "text": "3.1.1 Common data sources\n\n3.1.2 Doctors data\nThe … comes from Our World in Data (Data 2019)\n\ndoctors &lt;- readr::read_csv(\"data/doctors.csv\")",
    "crumbs": [
      "Visualising spatial data",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Doctors in an ageing population: making maps with {ggplot2}</span>"
    ]
  },
  {
    "objectID": "doctors-ageing-population.html#initial-exploration",
    "href": "doctors-ageing-population.html#initial-exploration",
    "title": "3  Doctors in an ageing population: making maps with {ggplot2}",
    "section": "\n3.2 Initial exploration",
    "text": "3.2 Initial exploration",
    "crumbs": [
      "Visualising spatial data",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Doctors in an ageing population: making maps with {ggplot2}</span>"
    ]
  },
  {
    "objectID": "doctors-ageing-population.html#sketches",
    "href": "doctors-ageing-population.html#sketches",
    "title": "3  Doctors in an ageing population: making maps with {ggplot2}",
    "section": "\n3.3 Sketches",
    "text": "3.3 Sketches",
    "crumbs": [
      "Visualising spatial data",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Doctors in an ageing population: making maps with {ggplot2}</span>"
    ]
  },
  {
    "objectID": "doctors-ageing-population.html#data-wrangling",
    "href": "doctors-ageing-population.html#data-wrangling",
    "title": "3  Doctors in an ageing population: making maps with {ggplot2}",
    "section": "\n3.4 Data wrangling",
    "text": "3.4 Data wrangling\n\nlibrary(tidyr)\nlibrary(dplyr)\ndoctors &lt;- doctors |&gt;\n  rename(region = entity, doctors = `Physicians (per 1,000 people)`) |&gt;\n  select(region, year, doctors) |&gt;\n  group_by(region) |&gt;\n  slice_max(year) |&gt;\n  ungroup()",
    "crumbs": [
      "Visualising spatial data",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Doctors in an ageing population: making maps with {ggplot2}</span>"
    ]
  },
  {
    "objectID": "doctors-ageing-population.html#map-data",
    "href": "doctors-ageing-population.html#map-data",
    "title": "3  Doctors in an ageing population: making maps with {ggplot2}",
    "section": "\n3.5 Map data",
    "text": "3.5 Map data\n\nlibrary(ggplot2)\nworld &lt;- map_data(\"world\")\nlength(unique(world$region))\n\n[1] 252\n\nlength(unique(doctors$region))\n\n[1] 221\n\n\nNote that recode has the rather unusual syntax of old_name = new_name\n \n\nplot_data &lt;- doctors |&gt;\n  mutate(\n    country =\n      recode(region,\n        \"United Kingdom\" = \"UK\",\n        \"United States\" = \"USA\",\n        \"Congo, Dem. Rep.\" = \"Democratic Republic of the Congo\",\n        \"Cote d'Ivoire\" = \"Ivory Coast\",\n        \"Congo, Rep.\" = \"Republic of Congo\"\n      )\n  )\nmap_data &lt;- left_join(world, plot_data, by = \"region\") |&gt;\n  filter(region != \"Antarctica\")",
    "crumbs": [
      "Visualising spatial data",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Doctors in an ageing population: making maps with {ggplot2}</span>"
    ]
  },
  {
    "objectID": "doctors-ageing-population.html#plot",
    "href": "doctors-ageing-population.html#plot",
    "title": "3  Doctors in an ageing population: making maps with {ggplot2}",
    "section": "\n3.6 Plot",
    "text": "3.6 Plot\n\n3.6.1 Basic plot\n\n\nggplot(\n  data = map_data,\n  mapping = aes(\n    long,\n    lat,\n    map_id = region,\n    fill = doctors\n  )\n) +\n  geom_map(\n    map = map_data\n  )\n\n\n\n\n\n\n\nnot a great colour scheme bit stretched looking\n\nggplot(\n  data = map_data,\n  mapping = aes(\n    long,\n    lat,\n    map_id = region,\n    fill = doctors\n  )\n) +\n  geom_map(\n    map = map_data\n  ) #+\n\n\n\n\n\n\n  #coord_map()\n\n\nNote: ℹ The package “mapproj” is required for coord_map(). ✖ Would you like to install it?\n\n1: Yes 2: No\n\n3.6.2 Text and font\n \n\nsysfonts::font_add_google(name = \"Roboto\", family = \"roboto\")\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi = 300)\nbody_font &lt;- \"roboto\"\n\n\ntitle &lt;- \"Doctors in an ageing population\"\nst &lt;- \"This map show the number of doctors per thousand people, rescaled by the percentage of the population aged over 70, revealing which countries* may be more likely to struggle in providing care for an elderly population.&lt;br&gt; using most recent available data for each country.\"\ncap &lt;- \"**Data**: Our World in Data | **Graphic**: N. Rennie\"\n\n\n3.6.3 Colours\n\n\nlibrary(MetBrewer)\ncol_palette &lt;- met.brewer(\"Hokusai2\", n = 20)\ntext_col &lt;- col_palette[18]\nhighlight_col &lt;- col_palette[15]\nbg_col &lt;- \"#EADEDA\"\n\nlines of map same colour as bg and a little bit thinner add text\n \n\nlibrary(ggtext)\nggplot(\n  data = map_data,\n  mapping = aes(\n    long,\n    lat,\n    map_id = region,\n    fill = doctors\n  )\n) +\n  geom_map(\n    map = map_data,\n    color = bg_col,\n    linewidth = 0.05\n  ) +\n  labs(title = title, \n       subtitle = st,\n       caption = cap) +\n  scale_fill_gradientn(\n    colours = col_palette,\n    limits = c(0, 10),\n    breaks = c(0.5, 9.5),\n    labels = c(\"Fewer doctors\", \"More doctors\")\n  ) +\n  theme_void(base_family = body_font) +\n  theme(\n    plot.background = element_rect(fill = bg_col, colour = bg_col),\n    panel.background = element_rect(fill = bg_col, colour = bg_col),\n    plot.title = element_textbox_simple(\n      colour = text_col\n    ),\n    plot.subtitle = element_textbox_simple(\n      colour = text_col\n    ),\n    plot.caption = element_textbox_simple(\n      hjust = 0,\n      colour = text_col\n    ))\n\n\n\n\n\n\n\n\n3.6.4 Box for title facets\n\n\nggplot(\n  data = map_data,\n  mapping = aes(long,\n    lat,\n    map_id = region,\n    fill = log10(ratio)\n  )\n) +\n  geom_map(\n    map = map_data,\n    color = \"#EADEDA\",\n    size = 0.05\n  ) +\n  scale_y_continuous(limits = c(-60, 120)) +\n  scale_fill_gradientn(\n    colours = met.brewer(\"Hokusai2\", n = 20),\n    limits = c(-1.8, 0.7),\n    breaks = c(-1.6, 0.5),\n    labels = c(\"Fewer doctors\", \"More doctors\")\n  ) +\n  facet_wrap(~label) +\n  labs(\n    tag = usefunc::str_wrap_break(st, 120),\n    caption = \"N. Rennie | Data: Gapminder\"\n  ) +\n  guides(fill = guide_colourbar(ticks = FALSE)) +\n  theme_void() +\n  theme(\n    plot.background = element_rect(fill = \"#EADEDA\", colour = \"#EADEDA\"),\n    panel.background = element_rect(fill = \"#EADEDA\", colour = \"#EADEDA\"),\n    strip.text = element_text(\n      family = \"slab\", lineheight = 0.4, hjust = 0,\n      colour = \"#EADEDA\", size = 48,\n      margin = margin(\n        t = 10,\n        l = 10,\n        b = 10\n      )\n    ),\n    strip.background = element_rect(fill = \"#1B5681\", colour = \"#1B5681\"),\n    plot.tag.position = c(0.03, 0.78),\n    plot.tag = element_text(\n      family = \"roboto\", lineheight = 0.4, size = 24,\n      colour = \"#0E3F62\", hjust = 0\n    ),\n    plot.caption = element_text(\n      family = \"roboto\", lineheight = 0.4,\n      size = 24, hjust = 0.03,\n      colour = \"#0E3F62\"\n    ),\n    legend.text = element_text(\n      family = \"roboto\", lineheight = 0.4,\n      size = 24, hjust = 0.5,\n      colour = \"#0E3F62\"\n    ),\n    legend.key.width = unit(2, \"cm\"),\n    legend.key.height = unit(0.3, \"cm\"),\n    legend.position = c(0.645, -0.005),\n    legend.title = element_blank(),\n    legend.direction = \"horizontal\",\n    plot.margin = margin(0, 0, 10, 0)\n  )\n\n\nmap_data$label &lt;- \"Doctors in an ageing population\"\n\n\n3.6.5 Text\n\nst &lt;- \"This map show the number of doctors per thousand people, rescaled by the percentage of the population aged over 70, revealing which countries* may be more likely to struggle in providing care for an elderly population.\\n\\n* using most recent available data for each country.\"\n\nsee the making of . If you’d like to read more about {camcorder} - see chapter … .\n\n\n\n\n\nData, Our World in. 2019. “Medical Doctors Per 1,000 People, 2019.” https://ourworldindata.org/grapher/physicians-per-1000-people.",
    "crumbs": [
      "Visualising spatial data",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Doctors in an ageing population: making maps with {ggplot2}</span>"
    ]
  },
  {
    "objectID": "technology-adoption.html",
    "href": "technology-adoption.html",
    "title": "4  Technology adoption: making gauge charts with {ggforce}",
    "section": "",
    "text": "4.1 Data\nThe technology adoption (Comin and B. 2004) data comes from\n#tuesdata &lt;- tidytuesdayR::tt_load(\"2022-07-19\")\n#technology &lt;- tuesdata$technology\ntechnology &lt;- readr::read_csv(\"data/technology.csv\")\nThe technology data is reasonably large with 491636 rows and 7 columns. The data is in long format, and\nWhat might be an interesting aspect of this data to visualize?",
    "crumbs": [
      "Weird and wonderful: completely custom charts",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Technology adoption: making gauge charts with {ggforce}</span>"
    ]
  },
  {
    "objectID": "technology-adoption.html#initial-exploration",
    "href": "technology-adoption.html#initial-exploration",
    "title": "4  Technology adoption: making gauge charts with {ggforce}",
    "section": "\n4.2 Initial exploration",
    "text": "4.2 Initial exploration\nAs in other chapters n this book, we’ll start with some basic exploratory plots in base R. For example, we may look at the distribution of variables in each category using the barplot function:\n\nbarplot(\n  table(technology$category),\n  las = 2,\n  cex.axis = 0.5,\n  cex.names = 0.5\n)\n\n\n\n\n\n\n\nsome initial base R exploratory plots\nLet’s look at something more specific\nA list of all ISO3 country codes can be obtained by running unique(technology$iso3c), and from there we can choose a subset of countries we want to look at in more detail. Let’s look at Great Britain, USA, Sweden, Brazil, New Zealand, and Venezuela, and store these choices in a vector called countries. We also need to narrow down the data we want to consider - there are 194 different questions contained in the data. You can check by running length(unique(technology$label)). One variable we will consider further is the percentage of children who received a measles immunization - indicated by the \"pctimmunizmeas\" level in the variable column.\nAlthough including all years of data would better allow us to consider trends in the values, sometimes looking at a only a few snapshots can be more effective. For example, by considering only the years 1980 and 2010 as we’ll do here, readers get a Wow, look how much things have changed! message rather than the perhaps less impactful visual of a gradual trend. We can use the filter function from {dplyr} to filter our technology data set to consider only the rows showing data about percentage of children who received a measles immunization, in the years 1980 or 2010, and relating to countries in our specified vector of countries.\nWe no longer need the group, category, variable, or label columns, as these are constant for our data so we can remove these columns using select() from {dplyr}.\n\n# subset of countries to look at further\ncountries &lt;- c(\"GBR\", \"USA\", \"SWE\", \"BRA\", \"NZL\", \"VEN\")\n\n# subset data for specific topic, years, and countries\nmeasles_data &lt;- technology |&gt;\n  dplyr::filter(\n    label == \"% children who received a measles immunization\",\n    year %in% c(1980, 2010),\n    iso3c %in% countries\n  ) |&gt;\n  dplyr::select(-c(group, category, variable, label))\nhead(measles_data)\n\n# A tibble: 6 × 3\n  iso3c  year value\n  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;\n1 BRA    1980    57\n2 BRA    2010    99\n3 GBR    1980    53\n4 GBR    2010    89\n5 NZL    1980    80\n6 NZL    2010    91\n\n\nOur tidier data now shows just the percentage (value) of children who received a measles immunization in each country (iso3c), in each of 1980 and 2010 (year), How might we visualize this data?\nThere are a couple of obvious options that come to mind: a simple grouped bar chart, a slope chart, or indeed the (not often popular) pie chart Our choice of data visualization will depend on which aspects of the data we want to show. Do we want to compare 1980 to 2010? Do we want to compare countries to each other? Do we just want to show the range of values in the data? In this data, the most interesting example is a comparison between 1980 and 2010. Although a slope chart would likely work well for this data, we’re going a little bit more experimental with a gauge chart.\nAt the time of writing, there isn’t a built-in function in {ggplot2} to create gauge charts. If you’ve never heard of a gauge chart, this initial sketch might give you an idea of what we’re aiming for.\nphotos of sketches\nBefore …",
    "crumbs": [
      "Weird and wonderful: completely custom charts",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Technology adoption: making gauge charts with {ggforce}</span>"
    ]
  },
  {
    "objectID": "technology-adoption.html#data-wrangling",
    "href": "technology-adoption.html#data-wrangling",
    "title": "4  Technology adoption: making gauge charts with {ggforce}",
    "section": "\n4.3 Data wrangling",
    "text": "4.3 Data wrangling\n\nplot_data &lt;- measles_data |&gt;\n  dplyr::mutate(no_value = 100 - value) |&gt;\n  tidyr::pivot_longer(\n    cols = c(value, no_value),\n    names_to = \"YN\",\n    values_to = \"perc\"\n  ) |&gt;\n  tidyr::pivot_wider(names_from = \"year\", values_from = \"perc\") |&gt;\n  dplyr::mutate(YN = factor(YN)) |&gt;\n  dplyr::mutate(\n    perc_1980 = `1980` / 100,\n    perc_2010 = `2010` / 100\n  ) |&gt;\n  dplyr::select(-c(`1980`, `2010`)) |&gt;\n  dplyr::group_by(iso3c) |&gt;\n  dplyr::mutate(\n    ymax_1980 = cumsum(perc_1980),\n    ymax_2010 = cumsum(perc_2010)\n  )\nhead(plot_data)\n\n# A tibble: 6 × 6\n# Groups:   iso3c [3]\n  iso3c YN       perc_1980 perc_2010 ymax_1980 ymax_2010\n  &lt;chr&gt; &lt;fct&gt;        &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;\n1 BRA   value         0.57      0.99      0.57      0.99\n2 BRA   no_value      0.43      0.01      1         1   \n3 GBR   value         0.53      0.89      0.53      0.89\n4 GBR   no_value      0.47      0.11      1         1   \n5 NZL   value         0.8       0.91      0.8       0.91\n6 NZL   no_value      0.2       0.09      1         1",
    "crumbs": [
      "Weird and wonderful: completely custom charts",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Technology adoption: making gauge charts with {ggforce}</span>"
    ]
  },
  {
    "objectID": "technology-adoption.html#the-ggforce-extension-package",
    "href": "technology-adoption.html#the-ggforce-extension-package",
    "title": "4  Technology adoption: making gauge charts with {ggforce}",
    "section": "\n4.4 The {ggforce} extension package",
    "text": "4.4 The {ggforce} extension package\nThe {ggforce} extension package (Pedersen 2022) contains many useful functions which extend the behavior of {ggplot2}, many of them aimed at exploratory data visualisation. We won’t cover many of it’s function in this chapter, and instead we’ll focus on how to use it to create gauge charts.\n{ggforce} is available on CRAN and can be installed with the usual install.packages(\"ggforce\") command.\n\n4.4.1 Gauge charts with {ggforce}\ngeom_arc_bar()\n\n4.4.2 Reformatting data\ngauge data\nthis changed from original mutate_at\n\ngauge_data &lt;- plot_data |&gt;\n  dplyr::ungroup() |&gt;\n  dplyr::mutate(\n    ymin_1980 = c(rbind(\n      rep(0, length(countries)),\n      (dplyr::slice_head(plot_data, n = -1) |&gt;\n        dplyr::pull(ymax_1980))\n    ))\n  ) |&gt;\n  dplyr::mutate(\n    ymin_2010 = c(rbind(\n      rep(0, length(countries)),\n      (dplyr::slice_head(plot_data, n = -1) |&gt;\n        dplyr::pull(ymax_2010))\n    ))\n  ) |&gt;\n  dplyr::group_by(iso3c) |&gt;\n  dplyr::mutate(\n    dplyr::across(\n      dplyr::starts_with(\"y\", ignore.case = FALSE),\n      ~ scales::rescale(.,\n        to = pi * c(-0.5, 0.5),\n        from = 0:1\n      )\n    )\n  )",
    "crumbs": [
      "Weird and wonderful: completely custom charts",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Technology adoption: making gauge charts with {ggforce}</span>"
    ]
  },
  {
    "objectID": "technology-adoption.html#initial-plots",
    "href": "technology-adoption.html#initial-plots",
    "title": "4  Technology adoption: making gauge charts with {ggforce}",
    "section": "\n4.5 Initial plots",
    "text": "4.5 Initial plots\nbasic plot\n\nlibrary(ggplot2)\nbasic_plot &lt;- ggplot(data = gauge_data) +\n  ggforce::geom_arc_bar(\n    mapping = aes(\n      x0 = 0, y0 = 0,\n      r0 = 0.7, r = 1,\n      start = ymin_2010, end = ymax_2010,\n      fill = YN\n    )\n  ) +\n  ggforce::geom_arc_bar(\n    mapping = aes(\n      x0 = 0, y0 = 0,\n      r0 = 0.2, r = 0.5,\n      start = ymin_1980, end = ymax_1980,\n      fill = YN\n    )\n  ) +\n  facet_wrap(~iso3c, nrow = 2)\nbasic_plot\n\n\n\n\n\n\nFigure 4.1: Initial plot created using geom_arc_bar() from {ggforce}, facetted by different countries.",
    "crumbs": [
      "Weird and wonderful: completely custom charts",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Technology adoption: making gauge charts with {ggforce}</span>"
    ]
  },
  {
    "objectID": "technology-adoption.html#colors",
    "href": "technology-adoption.html#colors",
    "title": "4  Technology adoption: making gauge charts with {ggforce}",
    "section": "\n4.6 Colors",
    "text": "4.6 Colors\n\nhighlight_col &lt;- \"#990c58\"\nsecond_col &lt;- \"#949398\"\nbg_col &lt;- \"#dedede\"\n\nadd new colors to basic plot\n\nbasic_plot &lt;- ggplot(data = gauge_data) +\n  ggforce::geom_arc_bar(\n    mapping = aes(\n      x0 = 0, y0 = 0,\n      r0 = 0.7, r = 1,\n      start = ymin_2010, end = ymax_2010,\n      fill = YN\n    ),\n    color = second_col\n  ) +\n  ggforce::geom_arc_bar(\n    mapping = aes(\n      x0 = 0, y0 = 0,\n      r0 = 0.2, r = 0.5,\n      start = ymin_1980, end = ymax_1980,\n      fill = YN\n    ),\n    color = second_col\n  ) +\n  facet_wrap(~iso3c, nrow = 2)\n\nadd scale fill\n\ncolor_plot &lt;- basic_plot +\n  scale_fill_manual(\n    breaks = c(\"value\", \"no_value\"),\n    labels = c(\"Immunised\", \"Not Immunised\"),\n    values = c(highlight_col, second_col)\n  )\ncolor_plot\n\n\n\n\n\n\nFigure 4.2: Edited version of the previous plot with colors changed from defaults to grey and dark pink.",
    "crumbs": [
      "Weird and wonderful: completely custom charts",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Technology adoption: making gauge charts with {ggforce}</span>"
    ]
  },
  {
    "objectID": "technology-adoption.html#text-and-fonts",
    "href": "technology-adoption.html#text-and-fonts",
    "title": "4  Technology adoption: making gauge charts with {ggforce}",
    "section": "\n4.7 Text and fonts",
    "text": "4.7 Text and fonts\nAs we’ve seen in previous chapters, we can load in Google fonts using the {sysfonts} and {showtext} packages. Here, we’ll keep it clean and minimal by using the \"Ubuntu\" font for both the title and the body font.\n\nsysfonts::font_add_google(name = \"Ubuntu\", family = \"ubuntu\")\nshowtext::showtext_auto()\nshowtext::showtext_opts(dpi = 300)\nbody_font &lt;- \"ubuntu\"\n\nwrite text social to add\n\ntitle &lt;- \"Measles Vaccinations\"\nsubtitle &lt;- \"The inner bar represents the percentage of children who received a measles immunisation in 1980, whilst the outer bar represents the percentage in 2010. An increase in immunisation levels between 1980 and 2010 is seen across all countries.\\n\\nN. Rennie | Data: data.nber.org (10.3386/w15319)\"\n\nSince axis labels tend not to make too much sense for geom-arc_bar() plots, we’ll remove them later when using the theme functions. Instead, we can add our own labels using geom_text() to the end of the gauges. To make it easier, we can construct a small data.frame specifically for adding text labels. This includes the x, and y coordinates where the text should be positioned (you can read these of from the graph we already have since we haven’t yet deleted the axis label), as well as the label that should appear.\n\ntext_df &lt;- data.frame(\n  x = c(0.35, 0.85),\n  y = c(-0.1, -0.1),\n  label = c(1980, 2010)\n)\n\nWe can then add this to the existing plot by adding a layer with geom_text(), noting that we need to specify the data argument as using the text dataframe we just created. We also need to specify the font family and size directly within the geom_text() function, and can add the title and subtitle text created earlier using the labs() function from {ggplot2}.\n\ntext_plot &lt;- color_plot +\n  geom_text(\n    data = text_df,\n    mapping = aes(x = x, y = y, label = label),\n    family = body_font,\n    size = 3\n  ) +\n  labs(\n    title = title,\n    subtitle = subtitle\n  )\ntext_plot\n\n\n\n\n\n\nFigure 4.3: Previous plot with additional labels indicating the year on each gauge chart, as well as an added title and subtitle.\n\n\n\n\nYou’ll notice that the subtitle text runs off the page here. Let’s fix that using {ggplot2} themes and {ggtext} functions.",
    "crumbs": [
      "Weird and wonderful: completely custom charts",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Technology adoption: making gauge charts with {ggforce}</span>"
    ]
  },
  {
    "objectID": "technology-adoption.html#themes-and-styling",
    "href": "technology-adoption.html#themes-and-styling",
    "title": "4  Technology adoption: making gauge charts with {ggforce}",
    "section": "\n4.8 Themes and styling",
    "text": "4.8 Themes and styling\nWe’ll start by removing all of the theme element such as the grey background, grid lines, axis labels. The easiest way to do this is using theme_void(). We can use the base_family argument of theme_void() to set the font family that will be used by default for any non-geom text elements that remain.\nYou may have noticed that the current gauge plots look a bit squashed and not exactly semi-circular. We can fix this by adding coord_fixed() which forces a 1:1 aspect ratio on the plot panel.\n\ntheme_plot1 &lt;- text_plot +\n  coord_fixed() +\n  theme_void(base_family = body_font)\ntheme_plot1\n\n\n\n\n\n\nFigure 4.4: Edited version of previous plot with fixed coordinate system to prevent squashing, and all theme elements removed.\n\n\n\n\nThis looks better but it’s still not great. What do we still need to improve with styling? The title text doesn’t stand out and blends in to easily with the subtitle, similarly for the facet text. Perhaps a bold font would help? The subtitle text doesn’t fit onto the page but we can fix that with the help of the hopefully now familiar element_textbox_simple() function from {ggtext} .\nbg col remove legend\nLet’s fix the first three of these issues.\n\nmain_plot &lt;- theme_plot1 +\n  theme(\n    legend.position = \"none\",\n    plot.background = element_rect(\n      fill = bg_col, color = bg_col\n    ),\n    panel.background = element_rect(\n      fill = bg_col, color = bg_col\n    ),\n    strip.text = element_text(\n      face = \"bold\", size = rel(1.2)\n    ),\n    plot.title = element_text(\n      margin = margin(t = 10, b = 10),\n      face = \"bold\",\n      size = rel(1.5)\n    ),\n    plot.subtitle = ggtext::element_textbox_simple(\n      maxwidth = 0.8,\n      lineheight = 0.5,\n      hjust = 0.5,\n    ),\n    plot.margin = margin(5, 5, 5, 5)\n  )\nmain_plot\n\n\n\n\n\n\nFigure 4.5: Further styling of gauge chart to change background color, prevent overlapping in the subtitle text, and increase the size of the title.",
    "crumbs": [
      "Weird and wonderful: completely custom charts",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Technology adoption: making gauge charts with {ggforce}</span>"
    ]
  },
  {
    "objectID": "technology-adoption.html#adding-a-better-legend",
    "href": "technology-adoption.html#adding-a-better-legend",
    "title": "4  Technology adoption: making gauge charts with {ggforce}",
    "section": "\n4.9 Adding a better legend",
    "text": "4.9 Adding a better legend\nAs we already saw in chapter …,\n\nlegend_plot &lt;- ggplot(\n  data = dplyr::filter(gauge_data, iso3c == \"USA\")\n) +\n  ggforce::geom_arc_bar(\n    mapping = aes(\n      x0 = 0, y0 = 0,\n      r0 = 0.7, r = 1,\n      start = ymin_2010, end = ymax_2010,\n      fill = YN\n    ),\n    color = second_col\n  ) +\n  ggforce::geom_arc_bar(\n    mapping = aes(\n      x0 = 0, y0 = 0,\n      r0 = 0.2, r = 0.5,\n      start = ymin_1980, end = ymax_1980,\n      fill = YN\n    ),\n    color = second_col\n  ) +\n  geom_text(\n    data = text_df,\n    mapping = aes(x = x, y = y, label = label),\n    family = body_font, size = 6\n  ) +\n  facet_wrap(~iso3c) +\n  scale_fill_manual(\n    breaks = c(\"value\", \"no_value\"),\n    labels = c(\"Immunised\", \"Not Immunised\"),\n    values = c(highlight_col, second_col)\n  ) +\n  labs(title = \"How do I read this plot?\") +\n  coord_fixed() +\n  theme_void(base_family = body_font) +\n  theme(\n    legend.position = \"bottom\",\n    legend.title = element_blank(),\n    plot.background = element_rect(\n      fill = \"transparent\", color = \"transparent\"\n    ),\n    panel.background = element_rect(\n      fill = \"transparent\", color = \"transparent\"\n    ),\n    plot.title = element_text(\n      hjust = 0.5,\n      face = \"italic\",\n      margin = margin(t = 10, b = 10)\n    ),\n    plot.margin = margin(5, 5, 5, 5)\n  )\nlegend_plot\n\n\n\n\n\n\nFigure 4.6: Version of the gauge chart shown only for USA which will act as a legend.",
    "crumbs": [
      "Weird and wonderful: completely custom charts",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Technology adoption: making gauge charts with {ggforce}</span>"
    ]
  },
  {
    "objectID": "technology-adoption.html#combining-legend-with-patchwork",
    "href": "technology-adoption.html#combining-legend-with-patchwork",
    "title": "4  Technology adoption: making gauge charts with {ggforce}",
    "section": "\n4.10 Combining legend with {patchwork}",
    "text": "4.10 Combining legend with {patchwork}\nJoin with {patchwork}\n\nlibrary(patchwork)\nfinal_plot &lt;- main_plot +\n  inset_element(legend_plot, 0.5, 0.9, 1.1, 1.4) &\n  theme(\n    plot.background = element_rect(\n      fill = bg_col, color = bg_col\n    ),\n    panel.background = element_rect(\n      fill = bg_col, color = bg_col\n    )\n  )\nfinal_plot\n\n\n\n\n\n\nFigure 4.7: Final gauge chart with overlaid legend in top right corner.\n\n\n\n\nAs with previous examples, don’t be fooled into thinking that the size of the legend and it’s positioning within the main plot is something that happened perfectly this first. The values are often picked through a series of trial and error, and with practice you’ll get better at choosing starting values.",
    "crumbs": [
      "Weird and wonderful: completely custom charts",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Technology adoption: making gauge charts with {ggforce}</span>"
    ]
  },
  {
    "objectID": "technology-adoption.html#reflection",
    "href": "technology-adoption.html#reflection",
    "title": "4  Technology adoption: making gauge charts with {ggforce}",
    "section": "\n4.11 Reflection",
    "text": "4.11 Reflection\nAre gauge charts the most effective method of visualising this data? No. Gauge charts have their own problems, some of which you can see here. Since the ring representing 2010 is on the outside, the radius is larger, and therefore the area . If you measure the change on arc length between 1980 and 2010, you’ll get different answers to if you measured the proportional change in area for the two.\n\n\n\n\nComin, D., and Hohijn B. 2004. “Cross-Country Technological Adoption: Making the Theories Face the Facts.” Journal of Monetary Economics January 2004: 39–83.\n\n\nPedersen, Thomas Lin. 2022. Ggforce: Accelerating ’Ggplot2’. https://CRAN.R-project.org/package=ggforce.",
    "crumbs": [
      "Weird and wonderful: completely custom charts",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Technology adoption: making gauge charts with {ggforce}</span>"
    ]
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "Comin, D., and Hohijn B. 2004. “Cross-Country Technological\nAdoption: Making the Theories Face the Facts.” Journal of\nMonetary Economics January 2004: 39–83.\n\n\nCommunity, R4DS Online Learning. 2023. “Tidy Tuesday: A Weekly\nSocial Data Project.” https://github.com/rfordatascience/tidytuesday.\n\n\nData, Our World in. 2019. “Medical Doctors Per 1,000 People,\n2019.” https://ourworldindata.org/grapher/physicians-per-1000-people.\n\n\nMuseums, Mapping. 2021. “Mapping Museums Data.” www.mappingmuseums.org.\n\n\nPedersen, Thomas Lin. 2022. Ggforce: Accelerating ’Ggplot2’. https://CRAN.R-project.org/package=ggforce.\n\n\nWickham, Hadley, Mine Çetinkaya-Rundel, and Garrett Grolemund. 2023.\nR for Data Science. O-Reilly. https://r4ds.hadley.nz.",
    "crumbs": [
      "References"
    ]
  }
]