---
filters:
  - line-highlight
execute: 
  freeze: auto
---

# Programming Languages: dumbbell charts with {ggplot2} {#programming}

## Data

[@pldb]

[@tidytuesdayR]

```{r}
#| label: programming-data
#| message: false
languages <- readr::read_csv("data/languages.csv")
```

What are the variables?

```{r}
#| label: programming-data-head
head(languages)
```


## Exploratory work

### Data exploration

### Exploratory sketches

## Preparing a plot

### Data wrangling

```{r}
#| label: data-wrangling
plot_data <- languages |>
  dplyr::filter(type == "pl") |>
  dplyr::filter(line_comment_token %in% c("//", "#", ";")) |>
  dplyr::select(title, appeared, line_comment_token, last_activity, language_rank) |>
  tidyr::drop_na() |>
  dplyr::mutate(label = paste("Comment token:", line_comment_token)) |>
  dplyr::group_by(label) |>
  dplyr::slice_head(n = 10) |>
  dplyr::mutate(n = factor(dplyr::row_number(), levels = 1:10)) |>
  dplyr::ungroup() |>
  dplyr::select(label, n, title, appeared, last_activity, language_rank) |>
  tidyr::pivot_longer(
    cols = c(appeared, last_activity),
    names_to = "type",
    values_to = "year"
  )
```

### Packages and functions

### The first plot


```{r}
#| label: basic-plot1
#| warning: false
library(ggplot2)
basic_plot <- ggplot(data = plot_data) +
  geom_line(mapping = aes(x = year, y = n, group = n)) +
  geom_point(mapping = aes(x = year, y = n)) +
  facet_wrap(~label)
basic_plot
```

reorder axes

```{r}
#| label: scales-plot
basic_plot +
  scale_y_discrete(limits = rev) +
  scale_x_continuous(
    breaks = c(1970, 1990, 2010, 2030),
    limits = c(1930, 2030),
    expand = c(0, 0)
  )
```

update to open ended

## Advanced styling

### Colours

Why save colours as variables?

```{r}
#| label: colour-vars
bg_col <- "grey5"
main_col <- "#66FF00"
```

redo plot

```{r}
#| label: basic-plot2
basic_plot <- ggplot(data = plot_data) +
  geom_line(
    mapping = aes(x = year, y = n, group = n),
    colour = main_col
  ) +
  geom_point(
    mapping = aes(x = year, y = n),
    colour = main_col,
    fill = bg_col,
    pch = 22
  ) +
  facet_wrap(~label) +
  # add scales back in
  scale_y_discrete(limits = rev) +
  scale_x_continuous(
    breaks = c(1970, 1990, 2010, 2030),
    limits = c(1930, 2030),
    expand = c(0, 0)
  )
basic_plot
```

### Text and fonts

{sysfonts}\index{sysfonts}
{showtext}\index{showtext}

Text as variables

```{r}
#| label: text-vars
title <- "Programming Languages"
subtitle <- "Of the 4,303 programming languages listed in the Programming Language DataBase, 205 use //, 101 use #, and 64 use ;
to define which lines are comments. 3,831 languages do not have a comment token listed."
caption <- "Data: Programming Language DataBase | Graphic: N. Rennie"
```

add to plot

```{r}
#| label: text_plot
text_plot <- basic_plot +
  labs(
    title = title,
    subtitle = subtitle,
    caption = caption
  )
text_plot
```

Choosing a font

showtext
google fonts

```{r}
#| label: showtext
sysfonts::font_add_google("VT323", "vt")
sysfonts::font_add_google("Share Tech Mono", "share")
showtext::showtext_auto()
showtext::showtext_opts(dpi = 300)
```

font as variables


```{r}
#| label: font-vars
body_font <- "share"
title_font <- "vt"
```


basic theming

```{r}
#| label: minimal-theme
theme_plot1 <- text_plot +
  theme_minimal(
    base_size = 8,
    base_family = body_font
  )
```

### Adjusting themes

better theme

```{r}
#| label: style1
theme_plot1 +
  theme(
    plot.background = element_rect(
      fill = bg_col,
      colour = bg_col
    ),
    panel.background = element_rect(
      fill = bg_col,
      colour = alpha(main_col, 0.5),
      linewidth = 0.4
    ),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(
      colour = alpha(main_col, 0.5),
      linewidth = 0.2
    ),
    panel.grid.major.y = element_blank(),
    strip.text = element_text(
      colour = main_col
    ),
    axis.text.y = element_blank(),
    axis.text.x = element_text(
      colour = main_col,
      vjust = 2
    ),
    plot.title = element_text(
      colour = main_col,
      family = title_font
    ),
    plot.subtitle = element_text(
      colour = main_col,
      margin = margin(b = 5)
    ),
    plot.caption = element_text(
      colour = main_col,
      margin = margin(b = 5),
      hjust = 0
    ),
    axis.ticks = element_blank(),
    plot.margin = margin(10, 15, 5, 0)
  )
```

make title bigger
stop subtitle running off
ggtext

```{r}
#| label: style2
theme_plot2 <- theme_plot1 +
  theme(
    plot.background = element_rect(
      fill = bg_col,
      colour = bg_col
    ),
    panel.background = element_rect(
      fill = bg_col,
      colour = alpha(main_col, 0.5),
      linewidth = 0.4
    ),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(
      colour = alpha(main_col, 0.5),
      linewidth = 0.2
    ),
    panel.grid.major.y = element_blank(),
    strip.text = element_text(
      colour = main_col
    ),
    axis.text.y = element_blank(),
    axis.text.x = element_text(
      colour = main_col,
      vjust = 2
    ),
    plot.title = element_text(
      colour = main_col,
      family = title_font,
      size = rel(2)
    ),
    plot.subtitle = ggtext::element_textbox_simple(
      colour = main_col,
      margin = margin(b = 5),
      lineheight = 0.5
    ),
    plot.caption = element_text(
      colour = main_col,
      margin = margin(b = 5),
      hjust = 0
    ),
    axis.ticks = element_blank(),
    plot.margin = margin(10, 15, 5, 0)
  )
theme_plot2
```

Add labels

```{r}
#| label: add-labels
theme_plot2 +
  geom_text(
    mapping = aes(x = 1932, y = n, label = title),
    family = body_font,
    vjust = 0.5,
    hjust = 0,
    size = 3,
    colour = main_col
  )
```


make better labels

```{r}
#| label: better-labels
plot_data <- plot_data |>
  dplyr::mutate(rank_label = glue::glue("{title}\nRank: {language_rank}"))
```

plot

```{r}
#| label: add-better-labels
theme_plot2 +
  geom_text(
    data = plot_data,
    mapping = aes(x = 1932, y = n, label = rank_label),
    family = body_font,
    vjust = 0.5,
    lineheight = 0.7,
    hjust = 0,
    size = 2.5,
    colour = main_col
  )
```

make html labels instead

```{r}
#| label: html-labels
plot_data <- plot_data |>
  dplyr::mutate(rank_label = glue::glue("<p>{title}</p><p style='font-size:6pt;'>(Rank: {language_rank})</p>"))
```

plot with geom_richtext ggtext

```{r}
#| label: add-html-labels
theme_plot2 +
  ggtext::geom_richtext(
    data = plot_data,
    mapping = aes(x = 1932, y = n, label = rank_label),
    family = body_font,
    fill = "transparent",
    label.colour = "transparent",
    vjust = 0.5,
    hjust = 0,
    size = 2.5,
    colour = main_col
  )
```

Saving an image

comments on dpi

```{r}
#| label: save
#| eval: false
#| echo: true
ggsave()
```

## Reflection

open ended

::: {.content-visible when-format="html"}

## The making of...

Each plot created during the process of developing the original version of this visualisation was captured using {camcorder}, and is shown in the gif below. If you'd like to learn more about how {camcorder} can be used in the data visualisation process, see @sec-camcorder.

![](images/languages.gif){fig-align="center"}

:::